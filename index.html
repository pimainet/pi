<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pi Cosmic Vault - Vũ trụ Tương Lai</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700&family=Quicksand:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link href="./styles/tailwind.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <style>
      html {
        scroll-behavior: smooth;
        overscroll-behavior: contain;
      }
      body {
        background: linear-gradient(135deg, #0a0a23 0%, #1a1a3d 100%);
        color: #e2e8f0;
        font-family: 'Quicksand', sans-serif;
        overflow-x: hidden;
        margin: 0;
        padding-bottom: 60px;
        min-height: 100vh;
      }
      #header {
        position: fixed;
        top: 0;
        width: 100%;
        background: linear-gradient(90deg, #00f0ff, #1a1a3d, #ff00ff);
        padding: 0.5rem;
        z-index: 100;
        box-shadow: 0 2px 15px rgba(0, 240, 255, 0.8);
      }
      #header .logo {
        font-family: 'Exo 2', sans-serif;
        font-size: 1.5rem;
        font-weight: 700;
        color: #e2e8f0;
        text-shadow: 0 0 8px #00f0ff, 0 0 16px #ff00ff;
      }
      .settings-btn {
        font-size: 1.5rem;
        background: none;
        border: none;
        color: #e2e8f0;
        cursor: pointer;
        padding: 0.5rem;
      }
      #tab-bar {
        position: fixed;
        bottom: 0;
        width: 100%;
        background: linear-gradient(180deg, #0a0a23, #1a1a3d);
        display: flex;
        justify-content: space-around;
        padding: 0.5rem 0;
        z-index: 100;
        border-top: 2px solid #00f0ff;
        box-shadow: 0 -2px 15px rgba(0, 240, 255, 0.5);
      }
      #tab-bar button {
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid #00f0ff;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        color: #e2e8f0;
        font-weight: 500;
        transition: all 0.3s ease;
        flex: 1;
        margin: 0 0.25rem;
      }
      #tab-bar button:hover {
        background: linear-gradient(45deg, #00f0ff, #ff00ff);
        color: #0a0a23;
        transform: scale(1.05);
      }
      #tab-bar button.active {
        background: #00f0ff;
        color: #0a0a23;
        box-shadow: 0 0 10px #00f0ff;
      }
      #starfield {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
      }
      #dashboard {
        margin-top: 60px;
        padding: 1rem;
        background: rgba(10, 10, 35, 0.9);
        border-radius: 12px;
        border: 2px solid #00f0ff;
        box-shadow: 0 0 20px rgba(0, 240, 255, 0.5);
        animation: fadeIn 1s ease-in;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .avatar-3d {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        border: 3px solid #00f0ff;
        box-shadow: 0 0 15px rgba(0, 240, 255, 0.7);
        transition: transform 0.5s ease;
        position: relative;
      }
      .avatar-3d::after {
        content: '';
        position: absolute;
        top: -5px;
        left: -5px;
        width: 88px;
        height: 88px;
        border: 2px solid #ff00ff;
        border-radius: 50%;
        animation: rotateHologram 3s linear infinite;
      }
      @keyframes rotateHologram {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      .avatar-3d:hover {
        transform: rotateY(360deg);
      }
      .user-info {
        flex: 1;
        margin-left: 1rem;
      }
      .tab-content {
        display: none;
        padding: 1rem;
      }
      .tab-content.active {
        display: block;
      }
      .btn {
        background: linear-gradient(45deg, #00f0ff, #ff00ff);
        padding: 0.75rem 1.5rem;
        border-radius: 10px;
        color: #0a0a23;
        font-size: 1rem;
        min-width: 120px;
        transition: all 0.3s ease;
        box-shadow: 0 0 10px rgba(0, 240, 255, 0.5);
      }
      .btn:hover {
        transform: scale(1.05);
        box-shadow: 0 0 20px rgba(0, 240, 255, 0.8);
      }
      .btn:active {
        transform: scale(0.95);
      }
      .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }
      .modal-overlay.show {
        display: flex;
      }
      .modal {
        background: rgba(15, 15, 45, 0.95);
        border: 2px solid #00f0ff;
        border-radius: 12px;
        padding: 1.5rem;
        max-width: 90%;
        width: 300px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 0 30px rgba(0, 240, 255, 0.6);
      }
      .modal::-webkit-scrollbar {
        width: 6px;
      }
      .modal::-webkit-scrollbar-thumb {
        background: #00f0ff;
        border-radius: 3px;
      }
      .plasma-effect {
        position: absolute;
        width: 150px;
        height: 150px;
        opacity: 0;
        animation: plasmaWave 4s ease-in-out forwards;
        pointer-events: none;
        z-index: 50;
      }
      @keyframes plasmaWave {
        0% { transform: translate(-100%, 100%) scale(0); opacity: 0; }
        50% { transform: translate(50%, -50%) scale(1); opacity: 1; }
        100% { transform: translate(200%, -100%) scale(0); opacity: 0; }
      }
      .plasma-effect.show {
        opacity: 1;
      }
      .lotus-hologram {
        position: absolute;
        width: 100px;
        opacity: 0;
        animation: bloomHologram 3s ease-in-out forwards;
        filter: drop-shadow(0 0 10px #00f0ff);
      }
      @keyframes bloomHologram {
        0% { transform: scale(0); opacity: 0; }
        50% { transform: scale(1.2); opacity: 1; }
        100% { transform: scale(1); opacity: 1; }
      }
      .lotus-hologram.show {
        opacity: 1;
      }
      .chat-box {
        border: 2px solid #00f0ff;
        border-radius: 8px;
        padding: 0.5rem;
        background: rgba(255, 255, 255, 0.05);
        height: 150px;
        overflow-y: auto;
        font-size: 0.9rem;
      }
      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #00f0ff;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 1rem auto;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      .balance-container {
        background: linear-gradient(45deg, #00f0ff, #ff00ff);
        padding: 0.5rem;
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(0, 240, 255, 0.7);
      }
      .balance-container span {
        font-family: 'Exo 2', sans-serif;
        font-weight: 700;
        color: #0a0a23;
        text-shadow: 0 0 5px #e2e8f0;
      }
      .video-container {
        position: relative;
        padding-top: 56.25%;
      }
      .video-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }
      @media (max-width: 640px) {
        #header { padding: 0.25rem; }
        .logo { font-size: 1.2rem; }
        #dashboard { margin-top: 50px; padding: 0.5rem; }
        .avatar-3d { width: 60px; height: 60px; }
        .avatar-3d::after { width: 68px; height: 68px; top: -4px; left: -4px; }
        .btn { padding: 0.5rem 1rem; font-size: 0.9rem; min-width: 100px; }
        .plasma-effect { width: 100px; height: 100px; }
        .lotus-hologram { width: 80px; }
        .video-container { padding-top: 75%; }
        #tab-bar button { padding: 0.5rem; font-size: 0.9rem; }
        .user-info { margin-left: 0.5rem; }
        .user-info h2 { font-size: 1rem; }
        .user-info span { font-size: 0.9rem; }
      }
    </style>
  </head>
  <body>
    <div id="starfield"></div>
    <div id="header" class="flex justify-between items-center">
      <span class="logo">Pi Cosmic Vault</span>
      <button class="settings-btn" onclick="openSettingsModal()">⚙️</button>
    </div>
    <div id="dashboard" class="container mx-auto">
      <div id="loadingSpinner" class="spinner mx-auto" style="display: none;"></div>
      <div class="flex items-center mb-2">
        <div class="avatar-3d">
          <img
            id="avatar"
            src="https://source.unsplash.com/100x100/?space,astronaut"
            alt="Avatar Sci-Fi"
            class="w-full h-full rounded-full"
            loading="lazy"
          />
        </div>
        <div class="user-info">
          <h2 id="userName" class="text-xl font-bold">Nhà du hành vũ trụ</h2>
          <span id="userLevel" class="text-lg">Cấp 1: Nhà Thám Hiểm Vũ Trụ</span>
          <div class="mt-1 balance-container">
            <span class="text-sm">Pi: <span id="piBalance">0</span></span>
            <span class="text-sm">Pidoge: <span id="pidogeBalance">0</span></span>
            <span class="text-sm">tlk: <span id="tlkBalance">0</span></span>
          </div>
        </div>
      </div>
      <div id="wallet" class="tab-content active">
        <p class="text-lg">Mã ví: <span id="walletAddress" class="break-words">Chưa nhập</span></p>
        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mt-2">
          <button onclick="copyWalletAddress()" class="btn">Sao chép</button>
          <button onclick="checkBalance()" class="btn">Kiểm tra</button>
        </div>
      </div>
      <div id="explore" class="tab-content">
        <p class="text-lg">Trạng thái: <span id="checkInStatus">Chưa khám phá</span></p>
        <button id="checkInButton" onclick="checkIn()" class="btn mt-2">Khám phá</button>
        <button onclick="openHistoryModal()" class="btn mt-2">Xem nhật ký</button>
        <div id="leaderboard" class="mt-2">
          <h3 class="text-lg font-semibold">Bảng xếp hạng</h3>
          <ul id="leaderboardList"></ul>
        </div>
      </div>
      <div id="price" class="tab-content">
        <p class="text-lg">Giá Pi: <span id="piPrice">Đang tải...</span></p>
      </div>
      <div id="support" class="tab-content">
        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 mb-2">
          <button onclick="openSafetyModal()" class="btn">Kiểm tra an toàn</button>
          <button onclick="openChatModal()" class="btn">Chat Grok</button>
        </div>
        <p class="text-lg">Hotline: <a href="tel:+84987654321" class="text-yellow-400">+84 987 654 321</a></p>
        <div class="video-container mt-2">
          <iframe
            src="https://www.youtube.com/embed/dQw4w9WgXcQ"
            title="Hướng dẫn"
            frameborder="0"
            allow="accelerometer; clipboard-write; encrypted-media"
            allowfullscreen
            loading="lazy"
          ></iframe>
        </div>
      </div>
      <svg id="plasma" class="plasma-effect" viewBox="0 0 200 200">
        <circle cx="100" cy="100" r="80" fill="none" stroke="#00f0ff" stroke-width="10" opacity="0.8">
          <animate attributeName="r" from="80" to="100" dur="1s" repeatCount="indefinite" />
          <animate attributeName="opacity" from="0.8" to="0.2" dur="1s" repeatCount="indefinite" />
        </circle>
        <circle cx="100" cy="100" r="60" fill="none" stroke="#ff00ff" stroke-width="8" opacity="0.6">
          <animate attributeName="r" from="60" to="80" dur="1s" repeatCount="indefinite" />
          <animate attributeName="opacity" from="0.6" to="0.1" dur="1s" repeatCount="indefinite" />
        </circle>
      </svg>
      <img id="lotus" class="lotus-hologram" src="https://source.unsplash.com/100x100/?lotus" alt="Lotus Hologram" loading="lazy" />
    </div>
    <div id="tab-bar">
      <button class="active" onclick="showTab('wallet')">Ví Pi</button>
      <button onclick="showTab('explore')">Khám phá</button>
      <button onclick="showTab('price')">Giá Pi</button>
      <button onclick="showTab('support')">Hỗ trợ</button>
    </div>
    <div id="historyModal" class="modal-overlay">
      <div class="modal">
        <span class="modal-close" onclick="closeModal('historyModal')">×</span>
        <h2 class="text-xl font-bold">Nhật ký du hành</h2>
        <ul id="checkInHistory" class="mt-2"></ul>
        <button onclick="closeModal('historyModal')" class="btn mt-2">Đóng</button>
      </div>
    </div>
    <div id="safetyModal" class="modal-overlay">
      <div class="modal">
        <span class="modal-close" onclick="closeModal('safetyModal')">×</span>
        <h2 class="text-xl font-bold">Kiểm tra an toàn</h2>
        <select id="checkType" class="w-full p-2 mt-1 bg-gray-800 text-white rounded">
          <option value="website">Trang web</option>
          <option value="app">Ứng dụng</option>
        </select>
        <input id="safetyUrl" type="text" placeholder="Nhập URL" class="w-full p-2 mt-1 bg-gray-800 text-white rounded" />
        <button onclick="checkSafety()" class="btn mt-1">Kiểm tra</button>
        <div id="safetyResult" class="mt-2 hidden">
          <p>Kết quả: <span id="safetyStatus"></span></p>
          <p>Điểm tin cậy: <span id="safetyScore"></span>/100</p>
          <p>Cảnh báo: <span id="safetyWarnings"></span></p>
        </div>
      </div>
    </div>
    <div id="chatModal" class="modal-overlay">
      <div class="modal">
        <span class="modal-close" onclick="closeModal('chatModal')">×</span>
        <h2 class="text-xl font-bold">Chat với Grok</h2>
        <div id="chatBox" class="chat-box mt-1"></div>
        <input id="chatInput" type="text" placeholder="Nhập tin nhắn..." class="w-full p-2 mt-1 bg-gray-800 text-white rounded" />
        <button onclick="sendMessage()" class="btn mt-1">Gửi</button>
      </div>
    </div>
    <div id="settingsModal" class="modal-overlay">
      <div class="modal">
        <span class="modal-close" onclick="closeModal('settingsModal')">×</span>
        <h2 class="text-xl font-bold">Cài đặt</h2>
        <p>Chưa có tùy chọn cài đặt</p>
        <button onclick="closeModal('settingsModal')" class="btn mt-2">Đóng</button>
      </div>
    </div>
    <audio id="checkInSound" src="https://assets.mixkit.co/sfx/preview/mixkit-sci-fi-laser-897.mp3"></audio>
    <script>
      const API_BASE_URL = 'https://pi-wallet.onrender.com';
      const LEVEL_AVATARS = { 1: 'https://source.unsplash.com/100x100/?space,astronaut', 2: 'https://source.unsplash.com/100x100/?space,galaxy', 3: 'https://source.unsplash.com/100x100/?space,nebula' };
      const LEVEL_NAMES = { 1: 'Cấp 1: Nhà Thám Hiểm Vũ Trụ', 2: 'Cấp 2: Người Dẫn Lối Ngôi Sao', 3: 'Cấp 3: Bậc Thầy Thiên Hà' };

      function initStarfield() {
        if (typeof particlesJS === 'undefined') {
          document.getElementById('starfield').style.background = '#0a0a23';
          return;
        }
        particlesJS('starfield', {
          particles: { number: { value: 50 }, color: { value: '#fff' }, size: { value: 2 }, move: { speed: 1, direction: 'bottom' } },
          interactivity: { events: { resize: true } },
        });
      }

      function showToast(message) {
        const toast = document.createElement('div');
        toast.textContent = message;
        toast.style.position = 'fixed';
        toast.style.top = '10px';
        toast.style.right = '10px';
        toast.style.background = '#00f0ff';
        toast.style.padding = '0.5rem 1rem';
        toast.style.borderRadius = '6px';
        toast.style.color = '#0a0a23';
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
      }

      function showTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        document.querySelectorAll('#tab-bar button').forEach(b => b.classList.remove('active'));
        document.querySelector(`#tab-bar button[onclick*="showTab('${tabId}')"]`).classList.add('active');
      }

      function openModal(modalId) { document.getElementById(modalId).classList.add('show'); }
      function closeModal(modalId) { document.getElementById(modalId).classList.remove('show'); }

      function openSettingsModal() { openModal('settingsModal'); }

      async function loadUserData() {
        const loadingSpinner = document.getElementById('loadingSpinner');
        const tagId = new URLSearchParams(window.location.search).get('tag_id');
        loadingSpinner.style.display = 'block';
        if (!tagId) {
          document.getElementById('userName').textContent = 'Khách viếng thăm';
          document.getElementById('walletAddress').textContent = 'Chưa đăng nhập';
          loadingSpinner.style.display = 'none';
          return;
        }
        try {
          const response = await fetch(`${API_BASE_URL}/api/user/${tagId}`);
          const user = await response.json();
          if (response.ok) {
            document.getElementById('userName').textContent = user.name || 'Nhà du hành vũ trụ';
            document.getElementById('walletAddress').textContent = user.wallet_address || 'Chưa có';
            document.getElementById('piBalance').textContent = user.pi_balance || 0;
            document.getElementById('pidogeBalance').textContent = user.pidoge_balance || 0;
            document.getElementById('tlkBalance').textContent = user.tlk_balance || 0;
            document.getElementById('avatar').src = LEVEL_AVATARS[1];
            document.getElementById('userLevel').textContent = LEVEL_NAMES[1];
          } else throw new Error(user.error);
        } catch (err) {
          console.error(err);
          showToast('Lỗi tải dữ liệu: ' + err.message);
        } finally {
          loadingSpinner.style.display = 'none';
        }
      }

      async function checkIn() {
        const tagId = new URLSearchParams(window.location.search).get('tag_id');
        if (!tagId) return showToast('Tag ID không hợp lệ');
        const plasma = document.getElementById('plasma');
        plasma.classList.add('show');
        const lotus = document.getElementById('lotus');
        lotus.classList.add('show');
        const sound = document.getElementById('checkInSound');
        sound.play();
        showToast('Khám phá thành công!');
        document.getElementById('checkInStatus').textContent = 'Đã khám phá';
      }

      function copyWalletAddress() {
        const walletAddress = document.getElementById('walletAddress').textContent;
        if (walletAddress === 'Chưa có') return showToast('Không có mã ví');
        navigator.clipboard.writeText(walletAddress).then(() => showToast('Đã sao chép'));
      }

      function checkBalance() {
        const walletAddress = document.getElementById('walletAddress').textContent;
        if (walletAddress === 'Chưa có') return showToast('Không có mã ví');
        window.open(`https://blockexplorer.minepi.com/mainnet/accounts/${walletAddress}`);
      }

      function checkSafety() {
        const safetyResult = document.getElementById('safetyResult');
        safetyResult.classList.remove('hidden');
        document.getElementById('safetyStatus').textContent = 'An toàn';
        document.getElementById('safetyScore').textContent = '90';
        document.getElementById('safetyWarnings').textContent = 'Không có';
        showToast('Kiểm tra hoàn tất');
      }

      function sendMessage() {
        const chatInput = document.getElementById('chatInput');
        const chatBox = document.getElementById('chatBox');
        const message = chatInput.value;
        if (!message) return;
        chatBox.innerHTML += `<p><strong>Bạn:</strong> ${message}</p>`;
        chatBox.innerHTML += `<p><strong>Grok:</strong> Chào bạn! Tôi đang xử lý...</p>`;
        chatInput.value = '';
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      function loadPrice() {
        document.getElementById('piPrice').textContent = '$0.015 (Giả lập)';
      }

      function loadLeaderboard() {
        const leaderboardList = document.getElementById('leaderboardList');
        leaderboardList.innerHTML = `
          <li>Người dùng 1 - 1000 Pi</li>
          <li>Người dùng 2 - 800 Pi</li>
          <li>Người dùng 3 - 500 Pi</li>
        `;
      }

      function loadCheckInHistory() {
        const checkInHistory = document.getElementById('checkInHistory');
        checkInHistory.innerHTML = `
          <li>Khám phá - 2025-05-01</li>
          <li>Khám phá - 2025-05-02</li>
        `;
      }

      function openHistoryModal() {
        loadCheckInHistory();
        openModal('historyModal');
      }

      document.addEventListener('DOMContentLoaded', () => {
        initStarfield();
        loadUserData();
        loadPrice();
        loadLeaderboard();
        setTimeout(() => {
          const plasma = document.getElementById('plasma');
          plasma.classList.add('show');
        }, 1000);
      });
    </script>
  </body>
</html>
