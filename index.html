<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ví Pi - Đầy đủ</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- TradingView Widget Script -->
    <script src="https://s3.tradingview.com/tv.js"></script>
    <style>
      body {
        -webkit-tap-highlight-color: transparent;
        overscroll-behavior: none;
        touch-action: manipulation;
      }
      .btn {
        transition: all 0.1s ease;
      }
      .btn:active {
        transform: scale(0.95);
      }
      .modal {
        transition: opacity 0.3s ease;
      }
      #walletAddress {
        word-wrap: break-word;
        overflow-wrap: break-word;
        word-break: break-all;
        white-space: normal;
        font-size: 0.75rem;
        max-width: 100%;
      }
      .wallet-container {
        max-width: 100%;
        overflow: hidden;
      }
      #avatar {
        object-fit: cover;
      }
      #editModal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
      }
      #editModal.show {
        display: flex;
      }
      #tradingview_chart {
        width: 100%;
        height: 600px; /* Tăng chiều cao lên 600px để dễ nhìn hơn cho người lớn tuổi */
      }
    </style>
  </head>
  <body
    class="bg-gradient-to-b from-blue-100 to-gray-100 min-h-screen font-sans text-gray-800"
  >
    <div class="container mx-auto p-4 max-w-md">
      <!-- Card Section -->
      <div class="bg-white shadow-xl rounded-2xl p-6 mb-6">
        <div class="flex items-center mb-4">
          <img
            id="avatar"
            src="https://via.placeholder.com/80"
            alt="Avatar"
            class="w-20 h-20 rounded-full mr-4 border-2 border-blue-200"
          />
          <div class="flex-1 wallet-container">
            <h2 id="userName" class="text-xl font-bold truncate">
              Tên của bạn
            </h2>
            <p class="text-sm text-gray-500">
              Ví: <span id="walletAddress">Chưa nhập địa chỉ ví</span>
            </p>
          </div>
        </div>
        <div class="flex space-x-2">
          <button
            onclick="copyWalletAddress()"
            class="flex-1 bg-blue-500 text-white py-2 rounded-lg btn hover:bg-blue-600"
          >
            Sao chép ví
          </button>
          <button
            onclick="checkBalance()"
            class="flex-1 bg-green-500 text-white py-2 rounded-lg btn hover:bg-green-600"
          >
            Kiểm tra số dư
          </button>
          <button
            onclick="showEditModal()"
            class="flex-1 bg-yellow-500 text-white py-2 rounded-lg btn hover:bg-yellow-600"
          >
            Chỉnh sửa thông tin
          </button>
        </div>
      </div>

      <!-- Chart Section (TradingView Widget) -->
      <div class="bg-white shadow-xl rounded-2xl p-6 mb-6">
        <h3 class="text-lg font-bold mb-4">Giá Pi (USD)</h3>
        <div id="tradingview_chart"></div>
      </div>

      <!-- Safety Check Section -->
      <div class="bg-white shadow-xl rounded-2xl p-6 mb-6">
        <h3 class="text-lg font-bold mb-4">Kiểm tra Web/Ứng dụng</h3>
        <select id="checkType" class="w-full p-2 border rounded mb-4">
          <option value="website">Trang web</option>
          <option value="app">Ứng dụng</option>
        </select>
        <input
          id="safetyUrl"
          type="text"
          class="w-full p-2 border rounded mb-4"
          placeholder="Nhập URL (ví dụ: https://example.com hoặc link Google Play)"
        />
        <button
          onclick="checkSafety()"
          class="w-full bg-indigo-500 text-white py-2 rounded-lg btn hover:bg-indigo-600"
        >
          Kiểm tra
        </button>
        <div id="safetyResult" class="mt-4 hidden">
          <p class="text-sm font-bold">
            Kết quả: <span id="safetyStatus"></span>
          </p>
          <p class="text-sm">
            Điểm tin cậy: <span id="safetyScore"></span>/100
          </p>
          <p class="text-sm">Cảnh báo: <span id="safetyWarnings"></span></p>
        </div>
      </div>

      <!-- Check-in and Management Section -->
      <div class="bg-white shadow-xl rounded-2xl p-6 mb-6">
        <h3 class="text-lg font-bold mb-4">Quản lý Ví</h3>
        <div class="space-y-4">
          <div class="flex items-center justify-between">
            <button
              onclick="checkIn()"
              id="checkInButton"
              class="bg-purple-500 text-white py-2 px-4 rounded-lg btn hover:bg-purple-600"
            >
              Điểm danh
            </button>
            <div>
              <p id="ppBalance" class="text-sm text-gray-600">0 PP</p>
              <p id="pidogeBalance" class="text-sm text-gray-600">0 Pidoge</p>
            </div>
          </div>
          <div class="flex items-center justify-between">
            <button
              onclick="convertPPtoPi()"
              class="bg-yellow-500 text-white py-2 px-4 rounded-lg btn hover:bg-yellow-600"
            >
              Đổi PP → Pi
            </button>
            <p id="piBalance" class="text-sm text-gray-600">0 Pi</p>
          </div>
          <div class="flex items-center justify-between">
            <button
              onclick="withdrawPi()"
              class="bg-red-500 text-white py-2 px-4 rounded-lg btn hover:bg-red-600"
            >
              Rút Pi (tối thiểu 1$)
            </button>
            <p id="withdrawStatus" class="text-sm text-gray-600"></p>
          </div>
        </div>
        <p id="checkInStatus" class="text-sm text-gray-600 mt-2 hidden">
          Đã điểm danh hôm nay!
        </p>
      </div>

      <!-- Support Section -->
      <div class="bg-white shadow-xl rounded-2xl p-6">
        <h3 class="text-lg font-bold mb-4">Hỗ trợ</h3>
        <p class="text-sm text-gray-600 mb-2">
          Liên hệ:
          <a href="mailto:support@example.com" class="text-blue-500"
            >support@example.com</a
          >
        </p>
        <p class="text-sm text-gray-600 mb-4">
          Hotline:
          <a href="tel:+84987654321" class="text-blue-500">+84 987 654 321</a>
        </p>
        <h4 class="text-md font-bold mb-2">Video hướng dẫn</h4>
        <div class="relative" style="padding-top: 56.25%">
          <iframe
            class="absolute top-0 left-0 w-full h-full rounded-lg"
            src="https://www.youtube.com/embed/dQw4w9WgXcQ"
            title="Hướng dẫn sử dụng ví Pi"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen
          ></iframe>
        </div>
      </div>

      <!-- Edit Modal -->
      <div
        id="editModal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center"
      >
        <div class="bg-white rounded-lg p-6 w-11/12 max-w-sm">
          <h3 class="text-lg font-bold mb-4">Chỉnh sửa Thông Tin</h3>
          <input
            id="editUserName"
            type="text"
            class="w-full p-2 border rounded mb-4"
            placeholder="Tên của bạn"
          />
          <input
            id="editWalletAddress"
            type="text"
            class="w-full p-2 border rounded mb-4"
            placeholder="Địa chỉ ví"
          />
          <div class="mb-4">
            <p class="text-sm text-gray-600 mb-2">
              Kéo thả hoặc chọn hình ảnh:
            </p>
            <input
              id="editAvatarInput"
              type="file"
              accept="image/*"
              class="w-full p-2 border rounded mb-2"
            />
            <div
              id="editDropZone"
              class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center"
            >
              <p class="text-sm text-gray-600">Kéo thả hình ảnh vào đây</p>
            </div>
          </div>
          <input
            id="passwordInput"
            type="password"
            class="w-full p-2 border rounded mb-4"
            placeholder="Nhập mật khẩu"
          />
          <div class="flex justify-end space-x-2">
            <button
              onclick="hideEditModal()"
              class="bg-gray-300 text-gray-800 py-2 px-4 rounded hover:bg-gray-400"
            >
              Hủy
            </button>
            <button
              onclick="saveChanges()"
              class="bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600"
            >
              Lưu
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      const memberData = {
        "001": {
          name: "HOÀNG VĂN MINH ",
          avatar: "https://bom.so/gmB6v2",
          wallet_address:
            "GAB3DTZTDHAQQ2IXO4RDPMYQY3CNZABM6ZGK4HWK55QKRQ6W6QCKRSDQ",
          explorer_link:
            "https://blockexplorer.minepi.com/mainnet/accounts/GAB3DTZTDHAQQ2IXO4RDPMYQY3CNZABM6ZGK4HWK55QKRQ6W6QCKRSDQ",
        },
        "002": {
          name: "LÊ VĂN HOẰNG",
          avatar:
            "https://cdn-ilcbnhb.nitrocdn.com/eyWebYtfntWmnihDSZRZvIqipddxdlOp/assets/images/optimized/rev-0a2b4a3/minepi.com/wp-content/uploads/2022/06/b7-1536x864.jpg",
          wallet_address:
            "GCVBQP2M5AWPLHFLUWX7ZRSE24INWWYEYC2EI3NPQWXIL5WVXXZITGJP",
          explorer_link:
            "https://blockexplorer.minepi.com/mainnet/accounts/GCVBQP2M5AWPLHFLUWX7ZRSE24INWWYEYC2EI3NPQWXIL5WVXXZITGJP",
        },
        "003": {
          name: "PHẠM THỊ XUÂN",
          avatar:
            "https://scontent.fthd2-4.fna.fbcdn.net/v/t39.30808-6/333513902_1932195023807300_1163851942859129592_n.jpg?_nc_cat=110&ccb=1-7&_nc_sid=6ee11a&_nc_eui2=AeEHUbUzai7uybMKKCX41vePUHHOaW9qRuVQcc5pb2pG5TMcLbXM7749XtjmZxexAOiueFtBjmWgkEO3QyI37KQg&_nc_ohc=2welsrt2YlMQ7kNvwFOc7hn&_nc_oc=Adk_sEaoXH3oRXMqnoqfoFZUJeW51zk8C1kGlxqHXsw4ssAxOaotBjRCgMthjIawAkRMVzySEDrzJzpaMu857opF&_nc_zt=23&_nc_ht=scontent.fthd2-4.fna&_nc_gid=fbVmX5ala3m2lS9mp2CWoA&oh=00_AfHdYB0zfaTS4NOm24PhuUW9b6Un0nwF_rlNw0Uz3HPn-w&oe=6810E999",
          wallet_address:
            "GBDUXC2JUGEVI7N2NGLXB6B3VMUUVNUK6QI4TL5XIB2LIY3U7CDGK3B4",
          explorer_link:
            "https://blockexplorer.minepi.com/mainnet/accounts/GBDUXC2JUGEVI7N2NGLXB6B3VMUUVNUK6QI4TL5XIB2LIY3U7CDGK3B4",
        },
        "004": {
          name: "LÊ THỊ HƯƠNG",
          avatar:
            "https://scontent.fthd2-4.fna.fbcdn.net/v/t39.30808-6/491577955_1189938295959905_8489318223622425228_n.jpg?_nc_cat=104&ccb=1-7&_nc_sid=833d8c&_nc_eui2=AeEKaNmN3EMNo5OPTJm-RTXghTawRiFc5_WFNrBGIVzn9Ru16jvb4yNoeTmWk3xiLZ9qkucZiptZAKXVCXh6-qhQ&_nc_ohc=XsGUn2tjS18Q7kNvwGmpi4-&_nc_oc=AdmTx9BTl2UKWp94btd4tMJRKnEbS5WceXszgrJ_EZgbxBXUsFgK8IDuYfMrcCQbyrRhC1MBxsVRSGZA852cw4sz&_nc_zt=23&_nc_ht=scontent.fthd2-4.fna&_nc_gid=9yomIWlBUAh83U6ENEt4Kw&oh=00_AfFb9s9k0xdsMtfF4H9cXikQXb4JxZlHTA7yZQZsz12g6g&oe=6810B70E",
          wallet_address:
            "GCWRIG2I5BNCTN5HXSMAYPQC45MRY7BQFX6AUUPAKTGACFZLBDGJG7I3",
          explorer_link:
            "https://blockexplorer.minepi.com/mainnet/accounts/GCWRIG2I5BNCTN5HXSMAYPQC45MRY7BQFX6AUUPAKTGACFZLBDGJG7I3",
        },
        "005": {
          name: "LÊ TRỌNG KHOA",
          avatar:
            "https://scontent.fthd2-4.fna.fbcdn.net/v/t39.30808-6/493192748_1733657324175687_1257877052875128746_n.jpg?_nc_cat=108&ccb=1-7&_nc_sid=127cfc&_nc_eui2=AeH8XsKzNXgL0yj8z53qHIOtaVJWQIRCD6FpUlZAhEIPoWvV_ysyrHvZPL6RcheGuoJ6PVB5QKk-G0NLasDmDZJg&_nc_ohc=7Px-qfQ5lWQQ7kNvwHYVFhk&_nc_oc=AdlpfYi2vi89mFfK7IPldFASnOFj3koz62XDT8UC5Q0xUTR_aY3SwcSCDv5Fup1zqqo_quOvwDEk_C4sHs19Purs&_nc_zt=23&_nc_ht=scontent.fthd2-4.fna&_nc_gid=exEYcb5mTNsTiCTOXVZr6A&oh=00_AfEs3ZBU6la6YyE0i-PZlOEDbZRw69eU9zOT7VJbJtg3ng&oe=6810F531",
          wallet_address:
            "GDMBS366RAH5STHNFCH3QWLV4VNK2U77TGFU7WEG66ZFGMHGOWZCHDOZ",
          explorer_link:
            "https://blockexplorer.minepi.com/mainnet/accounts/GDMBS366RAH5STHNFCH3QWLV4VNK2U77TGFU7WEG66ZFGMHGOWZCHDOZ",
        },
        "006": {
          name: "HOÀNG VĂN TRỤ",
          avatar:
            "https://scontent.fthd2-4.fna.fbcdn.net/v/t39.30808-6/493108752_1733753667499386_17622212115165894_n.jpg?_nc_cat=106&ccb=1-7&_nc_sid=127cfc&_nc_eui2=AeFWkb5oRJIywNLPIbarT4xAsXKWT3Q0IG2xcpZPdDQgbZLWj82Oe1iFMByWKW-T1pN3-jkNFbqcGzuCvZA8kwfw&_nc_ohc=u3JjcYuZ3HUQ7kNvwFpJuhS&_nc_oc=AdnqHLjnrpmTiBtX9uIlyjCnXBRxMsXfixwUT9c2OQBZ65Z53aC8PNtiiKH5fRaiIpOjQLtXWgkDjLJAjvGRde_Uhh&_nc_zt=23&_nc_ht=scontent.fthd2-4.fna&_nc_gid=PzpxmMuS2kTQyGk6q2qdbA&oh=00_AfHffHzmd2bPGcBrxcl7rtaT_HjpOuDn-SSyVnUYJ2ClXQ&oe=68113600",
          wallet_address:
            "GC4QQVU6A4EWTNCW4235WUOQ5FHKBOF57RKO2EPTIXDJKRYTLXZOHSGN",
          explorer_link:
            "https://blockexplorer.minepi.com/mainnet/accounts/GC4QQVU6A4EWTNCW4235WUOQ5FHKBOF57RKO2EPTIXDJKRYTLXZOHSGN",
        },
        "007": {
          name: "MINH TRANG",
          avatar:
            "https://scontent.fthd2-4.fna.fbcdn.net/v/t39.30808-6/459020914_2207803129648889_9083612727790770567_n.jpg?_nc_cat=103&ccb=1-7&_nc_sid=6ee11a&_nc_eui2=AeEJB1D7cb229eMaz1Tnljv37WSJkrt-6NXtZImSu37o1VVf19czvRfBbJtbDj5OR34CVLCU34_-69wPg090ODaa&_nc_ohc=lzre0bmBz-AQ7kNvwE7BfJp&_nc_oc=Adm9GKxGty-0Z42FQwYm0_uwI8Nd409RtQMch6rxOMi7eABoW5Mt6sByJdjrKm7jv_u_o5n4wbAmAZfr__fPcBGs&_nc_zt=23&_nc_ht=scontent.fthd2-4.fna&_nc_gid=N5PB6m8Jb2AphoVgDZwqCQ&oh=00_AfFrra6S7brzwMX_b23hAUnqPa4gQxdUkMUNMJFz49RlsQ&oe=68126FF6",
          wallet_address:
            "GD7M2UZCORSH4AJUJJN2V56MAA33OCIMYMRJ6OXMBQPG5T2FJ4OZ6TA6",
          explorer_link:
            "https://blockexplorer.minepi.com/mainnet/accounts/GD7M2UZCORSH4AJUJJN2V56MAA33OCIMYMRJ6OXMBQPG5T2FJ4OZ6TA6",
        },
        "008": {
          name: "LÊ THỊ HÀ",
          avatar:
            "https://scontent.fthd2-4.fna.fbcdn.net/v/t39.30808-6/491397391_122228848976217325_5812334186522958901_n.jpg?_nc_cat=101&ccb=1-7&_nc_sid=833d8c&_nc_eui2=AeGkgyQ87OtvNEhgg2G8NL2rwhyzNJKY4HbCHLM0kpjgdghCH501spAOZjH5JdhPl-dGkXQHUToUb8AsZm2_pr4h&_nc_ohc=CDt9Dj35ZmEQ7kNvwHzjhmP&_nc_oc=Adk5SG-e19biNbTLAauHy1rlHbBax96hK7tKu4v4hXaNEbwV_vznFKPrRGztEP1t8zDHFjJVjcBmGK3EGKf22QnV&_nc_zt=23&_nc_ht=scontent.fthd2-4.fna&_nc_gid=g6gl2ukwn3CLEAWEJSh_Hw&oh=00_AfE4YYjuD-c8SpfzVNTIwNnF3Cn-6yPM69g9RRmnTrrp1g&oe=6813C792",
          wallet_address:
            "GAL4V2DVKA437NPZT2B6NEQA7AJ4BE53OCKQUXNJ44G3Z3IJF3BGZ7SS",
          explorer_link:
            "https://blockexplorer.minepi.com/mainnet/accounts/GAL4V2DVKA437NPZT2B6NEQA7AJ4BE53OCKQUXNJ44G3Z3IJF3BGZ7SS",
        },
      };

      let userData = {
        name: "Tên của bạn",
        walletAddress: "Chưa nhập địa chỉ ví",
        avatar: "https://via.placeholder.com/80",
        balance: 5.0,
        ppBalance: 0,
        pidogeBalance: 0,
        piBalance: 0,
        lastCheckIn: null,
        password: "123456",
      };

      // Lấy tag_id từ URL và hiển thị thông tin khách hàng
      const urlParams = new URLSearchParams(window.location.search);
      const tagId = urlParams.get("tag_id");

      if (tagId && memberData[tagId]) {
        const member = memberData[tagId];
        userData.name = member.name;
        userData.walletAddress = member.wallet_address;
        userData.avatar = member.avatar;

        document.getElementById("userName").innerText = userData.name;
        document.getElementById("walletAddress").innerText =
          userData.walletAddress;
        document.getElementById("avatar").src = userData.avatar;
      } else {
        document.getElementById("userName").innerText =
          "Không tìm thấy thông tin";
        document.getElementById("walletAddress").innerText =
          "Không tìm thấy địa chỉ ví";
        document.getElementById("avatar").src =
          "https://via.placeholder.com/80";
      }

      // Hiển thị/thiết lập modal chỉnh sửa
      function showEditModal() {
        document.getElementById("editModal").classList.add("show");
        document.getElementById("editUserName").value = userData.name;
        document.getElementById("editWalletAddress").value =
          userData.walletAddress;
        document.getElementById("editAvatarInput").value = "";
      }

      function hideEditModal() {
        document.getElementById("editModal").classList.remove("show");
      }

      // Lưu thay đổi
      function saveChanges() {
        const password = document.getElementById("passwordInput").value.trim();
        if (password !== userData.password) {
          showModal("Mật khẩu không đúng!");
          return;
        }

        const editUserName = document
          .getElementById("editUserName")
          .value.trim();
        const editWalletAddress = document
          .getElementById("editWalletAddress")
          .value.trim();
        const editAvatarInput =
          document.getElementById("editAvatarInput").files[0];

        if (editUserName) {
          userData.name = editUserName;
          document.getElementById("userName").innerText = userData.name;
        }

        if (editWalletAddress) {
          userData.walletAddress = editWalletAddress;
          document.getElementById("walletAddress").innerText =
            userData.walletAddress;
        }

        if (editAvatarInput) {
          const reader = new FileReader();
          reader.onload = function (e) {
            userData.avatar = e.target.result;
            document.getElementById("avatar").src = userData.avatar;
          };
          reader.readAsDataURL(editAvatarInput);
        }

        hideEditModal();
        showModal("Thông tin đã được cập nhật!");
      }

      // Kéo thả hình ảnh trong modal
      const editDropZone = document.getElementById("editDropZone");
      editDropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        editDropZone.classList.add("border-blue-500");
      });
      editDropZone.addEventListener("dragleave", () => {
        editDropZone.classList.remove("border-blue-500");
      });
      editDropZone.addEventListener("drop", (e) => {
        e.preventDefault();
        editDropZone.classList.remove("border-blue-500");
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith("image/")) {
          const reader = new FileReader();
          reader.onload = function (event) {
            userData.avatar = event.target.result;
            document.getElementById("avatar").src = userData.avatar;
          };
          reader.readAsDataURL(file);
        } else {
          showModal("Vui lòng chọn một file hình ảnh!");
        }
      });

      // Sao chép địa chỉ ví
      function copyWalletAddress() {
        navigator.clipboard.writeText(userData.walletAddress);
        showModal("Đã sao chép địa chỉ ví!");
      }

      // Kiểm tra số dư
      function checkBalance() {
        showModal(`Số dư hiện tại: ${userData.balance.toFixed(2)} Pi`);
      }

      // Điểm danh
      function checkIn() {
        const today = new Date().toDateString();
        if (userData.lastCheckIn === today) {
          document.getElementById("checkInStatus").classList.remove("hidden");
          showModal("Bạn đã điểm danh hôm nay!");
          return;
        }

        const ppAdded = 5;
        const pidogeAdded = 50;
        userData.ppBalance += ppAdded;
        userData.pidogeBalance += pidogeAdded;
        userData.lastCheckIn = today;

        document.getElementById(
          "ppBalance"
        ).innerText = `${userData.ppBalance} PP`;
        document.getElementById(
          "pidogeBalance"
        ).innerText = `${userData.pidogeBalance} Pidoge`;
        document.getElementById("checkInStatus").classList.add("hidden");
        showModal(
          `Điểm danh thành công! Bạn nhận ${ppAdded} PP và ${pidogeAdded} Pidoge.`
        );
      }

      // Đổi PP ra Pi
      function convertPPtoPi() {
        if (userData.ppBalance < 100) {
          showModal("Cần ít nhất 100 PP để đổi thành 1 Pi!");
          return;
        }

        const piAmount = Math.floor(userData.ppBalance / 100);
        userData.piBalance += piAmount;
        userData.ppBalance -= piAmount * 100;

        document.getElementById(
          "ppBalance"
        ).innerText = `${userData.ppBalance} PP`;
        document.getElementById(
          "piBalance"
        ).innerText = `${userData.piBalance.toFixed(2)} Pi`;
        showModal(`Đổi thành công! Bạn nhận ${piAmount} Pi.`);
      }

      // Rút Pi
      function withdrawPi() {
        const piValueUSD = 1.0;
        const minWithdrawUSD = 1.0;
        const minWithdrawPi = minWithdrawUSD / piValueUSD;

        if (userData.piBalance < minWithdrawPi) {
          showModal(
            `Số dư không đủ! Cần tối thiểu ${minWithdrawPi.toFixed(
              2
            )} Pi (~1 USD).`
          );
          return;
        }

        const amountPi = userData.piBalance;
        userData.piBalance = 0;
        document.getElementById(
          "piBalance"
        ).innerText = `${userData.piBalance.toFixed(2)} Pi`;
        document.getElementById(
          "withdrawStatus"
        ).innerText = `Yêu cầu rút ${amountPi.toFixed(2)} Pi (~${(
          amountPi * piValueUSD
        ).toFixed(2)} USD). Vui lòng chờ xử lý thủ công.`;
        showModal(
          `Yêu cầu rút ${amountPi.toFixed(
            2
          )} Pi đã được gửi. Tôi sẽ chuyển thủ công về địa chỉ ví: ${
            userData.walletAddress
          }.`
        );
      }

      // Kiểm tra an toàn web/ứng dụng
      function checkSafety() {
        const url = document.getElementById("safetyUrl").value.trim();
        const type = document.getElementById("checkType").value;

        if (!url || !url.match(/^https?:\/\/.+/)) {
          showModal(
            "Vui lòng nhập URL hợp lệ (ví dụ: https://example.com hoặc link Google Play)!"
          );
          return;
        }

        let safetyData;
        if (type === "website") {
          safetyData = {
            score: url.includes("example") ? 85 : 45,
            status: url.includes("example") ? "An toàn" : "Nguy hiểm",
            color: url.includes("example") ? "green" : "red",
            warnings: url.includes("clipboard")
              ? ["Yêu cầu sao chép bộ nhớ tạm"]
              : [],
          };
        } else {
          safetyData = {
            score: url.includes("play.google.com") ? 90 : 40,
            status: url.includes("play.google.com") ? "An toàn" : "Nguy hiểm",
            color: url.includes("play.google.com") ? "green" : "red",
            warnings: url.includes("apk")
              ? ["Nguồn tải không chính thống", "Quyền truy cập bộ nhớ tạm"]
              : [],
          };
        }

        const resultDiv = document.getElementById("safetyResult");
        resultDiv.classList.remove("hidden");
        document.getElementById("safetyStatus").innerText = safetyData.status;
        document.getElementById(
          "safetyStatus"
        ).className = `text-${safetyData.color}-600`;
        document.getElementById("safetyScore").innerText = safetyData.score;
        document.getElementById("safetyWarnings").innerText = safetyData
          .warnings.length
          ? safetyData.warnings.join(", ")
          : "Không có cảnh báo";
      }

      // Hiển thị modal thông báo
      function showModal(message) {
        const modal = document.createElement("div");
        modal.className =
          "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center modal";
        modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-11/12 max-w-sm">
                    <p class="text-gray-800 mb-4">${message}</p>
                    <button onclick="this.parentElement.parentElement.remove()" class="bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600">OK</button>
                </div>
            `;
        document.body.appendChild(modal);
      }

      // Khởi tạo TradingView Widget
      window.onload = function () {
        new TradingView.widget({
          container_id: "tradingview_chart",
          width: "100%",
          height: "100%",
          symbol: "OKX:PIUSDT",
          interval: "D", // Khoảng thời gian: ngày
          timezone: "Etc/UTC",
          theme: "dark", // Theme tối để dễ nhìn
          style: "1", // Kiểu biểu đồ: nến
          locale: "en",
          toolbar_bg: "#1e222d", // Màu nền toolbar tối
          enable_publishing: false,
          allow_symbol_change: true,
          details: true,
          hotlist: true,
          calendar: true,
          studies: [
            "Volume@tv-basicstudies",
            "RSI@tv-basicstudies", // Chỉ báo RSI để hỗ trợ phân tích
          ],
          show_popup_button: true,
          popup_width: "1000",
          popup_height: "650",
          grid: {
            color: "#444", // Màu lưới tối, dễ nhìn
          },
        });
      };
    </script>
  </body>
</html>
