<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ví Pi - Đầy đủ</title>
    <!-- Google Fonts for Inter and Orbitron -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Orbitron:wght@700&display=swap"
      rel="stylesheet"
    />
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- TradingView Widget -->
    <script src="https://s3.tradingview.com/tv.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js"></script>
    <!-- Local CSS -->
    <style>
      /* Smooth Scroll */
      html {
        scroll-behavior: smooth;
        overscroll-behavior: contain;
        font-size: 16px !important;
      }

      /* Sci-Fi Cyberpunk Background */
      body {
        background: linear-gradient(135deg, #0A0A0A, #1A1A2E, #2E2E4D);
        position: relative;
        overflow-x: hidden;
        animation: gradientShift 12s ease infinite;
        color: #D0D0D0;
        font-family: 'Inter', sans-serif;
      }

      @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }

      /* Pi Universe Hub Title Card */
      .title-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(12px);
        border: 2px solid rgba(0, 209, 255, 0.4);
        position: relative;
        overflow: hidden;
        padding: 2rem;
        text-align: center;
        animation: glowPulse 2s ease-in-out infinite, borderGlow 4s ease-in-out infinite;
        will-change: box-shadow, border-color;
      }
      .title-card h1 {
        font-family: 'Orbitron', sans-serif;
        font-size: 2.5rem;
        color: #00D1FF;
        text-shadow: 0 0 15px rgba(0, 209, 255, 0.7), 0 0 30px rgba(179, 0, 255, 0.5);
        margin-bottom: 0.5rem;
        letter-spacing: 2px;
        text-transform: uppercase;
        animation: flicker 3s infinite;
      }
      .title-card p {
        font-size: 1.2rem;
        color: #F5F5F5;
        text-shadow: 0 0 8px rgba(179, 0, 255, 0.4);
        font-weight: 500;
        opacity: 0;
        animation: fadeIn 1s ease-in 1s forwards;
      }
      .title-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle, rgba(0, 209, 255, 0.1) 1px, transparent 1px);
        background-size: 10px 10px;
        animation: particleShift 20s linear infinite;
        opacity: 0.3;
      }
      @keyframes particleShift {
        0% { background-position: 0 0; }
        100% { background-position: 100px 100px; }
      }
      @keyframes glowPulse {
        0% { box-shadow: 0 0 20px rgba(0, 209, 255, 0.3); }
        50% { box-shadow: 0 0 40px rgba(0, 209, 255, 0.5); }
        100% { box-shadow: 0 0 20px rgba(0, 209, 255, 0.3); }
      }
      @keyframes borderGlow {
        0% { border-color: rgba(0, 209, 255, 0.4); }
        50% { border-color: rgba(179, 0, 255, 0.4); }
        100% { border-color: rgba(0, 209, 255, 0.4); }
      }
      @keyframes flicker {
        0%, 19.9%, 22%, 62.9%, 64%, 64.9%, 70%, 100% { opacity: 1; }
        20%, 21.9%, 63%, 63.9%, 65%, 69.9% { opacity: 0.6; }
      }
      @keyframes fadeIn {
        to { opacity: 1; }
      }

      /* Dark Mode */
      .dark-mode {
        background: linear-gradient(135deg, #0A0A0A, #1A1A2E, #2E2E4D);
        color: #D0D0D0;
      }
      .dark-mode .bg-white {
        background: rgba(26, 26, 46, 0.85);
        backdrop-filter: blur(10px);
      }
      .dark-mode .text-gray-800 {
        color: #F5F5F5;
      }
      .dark-mode .text-gray-500,
      .dark-mode .text-gray-600 {
        color: #00D1FF;
        text-shadow: 0 0 4px rgba(0, 209, 255, 0.3);
      }
      .dark-mode .bg-gray-200 {
        background: #3A3A5A;
      }
      .dark-mode .hover:bg-gray-300 {
        background: #4A4A6A;
      }
      .dark-mode .border-gray-300 {
        border-color: #3A3A5A;
      }
      .dark-mode .btn:hover {
        filter: brightness(1.2);
        box-shadow: 0 0 15px rgba(0, 209, 255, 0.6);
      }
      .dark-mode #userName,
      .dark-mode h3,
      .dark-mode h4 {
        color: #B300FF;
        text-shadow: 0 0 10px rgba(179, 0, 255, 0.5);
        font-weight: 800;
      }
      .dark-mode #walletAddress,
      .dark-mode #balanceDisplay,
      .dark-mode #safetyResult,
      .dark-mode #safetyStatus,
      .dark-mode #safetyScore,
      .dark-mode #safetyWarnings,
      .dark-mode #pidogeBalance,
      .dark-mode #ttBalance,
      .dark-mode #withdrawStatus,
      .dark-mode #checkInStatus,
      .dark-mode .text-sm {
        color: #00D1FF;
        text-shadow: 0 0 4px rgba(0, 209, 255, 0.3);
        font-weight: 500;
      }
      .dark-mode a {
        color: #00D1FF;
        text-shadow: 0 0 4px rgba(0, 209, 255, 0.3);
      }

      /* Glassmorphism Effect for Cards */
      .card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(0, 209, 255, 0.3);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        will-change: transform, box-shadow;
      }
      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(179, 0, 255, 0.3);
      }
      .card p, .card span {
        color: #F5F5F5;
        text-shadow: 0 0 4px rgba(0, 209, 255, 0.3);
        font-weight: 500;
        font-size: 1rem;
      }
      .card h2, .card h3, .card h4 {
        color: #B300FF;
        text-shadow: 0 0 10px rgba(179, 0, 255, 0.5);
        font-weight: 800;
        font-size: 1.25rem;
      }

      /* Button Ripple Effect with Neon Glow */
      .btn {
        position: relative;
        overflow: hidden;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        will-change: transform;
        background: linear-gradient(45deg, #00D1FF, #B300FF);
        color: #0A0A0A;
        font-weight: 600;
      }
      .btn:hover {
        transform: scale(1.05);
        box-shadow: 0 5px 15px rgba(0, 209, 255, 0.6);
      }
      .btn::after {
        content: "";
        position: absolute;
        background: rgba(255, 255, 255, 0.3);
        width: 100px;
        height: 100px;
        border-radius: 50%;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
        transition: transform 0.4s ease;
      }
      .btn:active::after {
        transform: translate(-50%, -50%) scale(1);
        opacity: 0;
      }

      /* Sound Toggle Button */
      #soundToggle {
        display: flex !important;
        visibility: visible;
        opacity: 1 !important;
        align-items: center;
        justify-content: center;
        width: 48px;
        height: 48px;
        min-width: 48px;
        min-height: 48px;
        padding: 0.75rem;
        background: rgba(255, 255, 255, 0.25);
        border: 3px solid #00D1FF;
        border-radius: 12px;
        box-shadow: 0 0 16px rgba(0, 209, 255, 0.7), 0 0 8px rgba(255, 255, 255, 0.3);
        animation: soundGlow 1.5s ease-in-out infinite;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        cursor: pointer;
        z-index: 200;
        flex-shrink: 0;
        touch-action: manipulation;
      }
      #soundToggle:hover {
        transform: scale(1.1);
        box-shadow: 0 0 24px rgba(179, 0, 255, 0.8), 0 0 12px rgba(255, 255, 255, 0.5);
      }
      #soundToggle svg {
        width: 28px;
        height: 28px;
        fill: #00D1FF !important;
      }
      @media (max-width: 640px) {
        #soundToggle {
          width: 48px;
          height: 48px;
          min-width: 48px;
          min-height: 48px;
          padding: 0.75rem;
        }
        #soundToggle svg {
          width: 28px;
          height: 28px;
        }
      }
      @keyframes soundGlow {
        0% { box-shadow: 0 0 16px rgba(0, 209, 255, 0.7), 0 0 8px rgba(255, 255, 255, 0.3); }
        50% { box-shadow: 0 0 24px rgba(179, 0, 255, 0.8), 0 0 12px rgba(255, 255, 255, 0.5); }
        100% { box-shadow: 0 0 16px rgba(0, 209, 255, 0.7), 0 0 8px rgba(255, 255, 255, 0.3); }
      }

      /* Ensure flex container doesn't hide soundToggle */
      .sound-toggle-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        min-width: 100%;
        flex-wrap: nowrap;
        gap: 12px;
      }
      @media (max-width: 640px) {
        .sound-toggle-container {
          flex-wrap: nowrap;
          justify-content: space-between;
          gap: 8px;
        }
        .sound-toggle-container .timer {
          flex: 1;
          min-width: 0;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
        }
      }

      /* Mini-Game Canvas */
      #gameCanvas {
        border: 2px solid rgba(0, 209, 255, 0.4);
        border-radius: 8px;
        background: url('https://i.imgur.com/xLt0X9f.jpeg') no-repeat center;
        background-size: cover;
        cursor: crosshair;
      }

      /* Energy Bar */
      .energy-bar-container {
        width: 100%;
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(0, 209, 255, 0.3);
        border-radius: 8px;
        overflow: hidden;
        position: relative;
      }
      .energy-bar {
        height: 20px;
        width: 0%;
        background: linear-gradient(90deg, #00D1FF, #B300FF);
        transition: width 0.3s ease;
        position: relative;
      }
      .energy-bar.full {
        background: linear-gradient(90deg, #FF3D3D, #B300FF);
        animation: glowFull 1s infinite;
      }
      @keyframes glowFull {
        0% { box-shadow: 0 0 10px rgba(255, 61, 61, 0.5); }
        50% { box-shadow: 0 0 20px rgba(255, 61, 61, 0.8); }
        100% { box-shadow: 0 0 10px rgba(255, 61, 61, 0.5); }
      }
      .energy-percentage {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #FFF;
        font-weight: 600;
        text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
      }

      /* Explosion Effect */
      .explosion {
        position: fixed;
        top: 50%;
        left: 50%;
        width: 200px;
        height: 200px;
        background: radial-gradient(circle, rgba(0, 209, 255, 0.8), transparent);
        border-radius: 50%;
        transform: translate(-50%, -50%) scale(0);
        animation: explode 0.5s ease-out forwards;
        pointer-events: none;
        z-index: 1000;
      }
      @keyframes explode {
        0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
        100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
      }

      /* Planet Interaction */
      #planetImage.shake {
        animation: shake 0.2s;
      }
      #planetImage.glow {
        box-shadow: 0 0 20px rgba(179, 0, 255, 1);
      }
      @keyframes shake {
        0% { transform: translate(0, 0); }
        25% { transform: translate(-2px, 2px); }
        50% { transform: translate(2px, -2px); }
        75% { transform: translate(-2px, 2px); }
        100% { transform: translate(0, 0); }
      }

      /* Timer */
      .timer {
        color: #FF3D3D;
        text-shadow: 0 0 5px rgba(255, 61, 61, 0.5);
        font-weight: 600;
      }

      /* Spinner Animation */
      .spinner {
        border: 4px solid #A0A0C0;
        border-top: 4px solid #00D1FF;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        animation: spin 1s linear infinite;
        display: none;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* Safety Status Colors */
      .safe {
        color: #00FF99;
        text-shadow: 0 0 8px rgba(0, 255, 153, 0.4);
        font-weight: 600;
      }
      .unsafe {
        color: #FF3D3D;
        text-shadow: 0 0 8px rgba(255, 61, 61, 0.4);
        font-weight: 600;
      }

      /* Modal Animation */
      .modal.show {
        opacity: 1;
        transform: scale(1);
      }
      .modal .modal-content {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(0, 209, 255, 0.4);
        transform: scale(0.8);
        transition: transform 0.3s ease, opacity 0.3s ease;
      }
      .modal.show .modal-content {
        transform: scale(1);
        opacity: 1;
      }
      .modal p, .modal span {
        color: #F5F5F5;
        text-shadow: 0 0 4px rgba(0, 209, 255, 0.3);
        font-weight: 500;
      }
      .modal h3 {
        color: #B300FF;
        text-shadow: 0 0 10px rgba(179, 0, 255, 0.5);
        font-weight: 800;
      }

      /* Toast Animation */
      #toast.show {
        transform: translateX(0);
        opacity: 1;
      }
      #toast {
        transition: transform 0.3s ease, opacity 0.3s ease;
        transform: translateX(100%);
        opacity: 0;
        background: rgba(0, 209, 255, 0.9);
        color: #0A0A0A;
        font-weight: 600;
      }

      /* Input Focus Animation */
      input:focus,
      select:focus {
        box-shadow: 0 0 10px rgba(0, 209, 255, 0.5);
        border-color: #00D1FF;
      }

      /* Avatar Styles */
      .avatar {
        width: 64px;
        height: 64px;
        border-radius: 8px;
        border: 2px solid transparent;
        object-fit: cover;
        transition: all 0.3s ease;
        opacity: 1;
        will-change: transform, box-shadow, border;
      }
      .avatar.loaded {
        opacity: 1;
      }
      .avatar:hover {
        transform: scale(1.1) rotate(3deg);
        box-shadow: 0 8px 16px rgba(179, 0, 255, 0.4);
        border: 2px solid #00D1FF;
      }
      .dark-mode .avatar:hover {
        border: 2px solid #B300FF;
      }

      /* Planet Image Styles */
      #planetImage {
        width: 64px;
        height: 64px;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid #00D1FF;
      }
      #planetImage:hover {
        box-shadow: 0 0 12px rgba(179, 0, 255, 0.5);
      }
    </style>
  </head>
  <body class="min-h-screen font-sans text-gray-800 transition-colors duration-500">
    <div class="container mx-auto p-4 max-w-md">
      <!-- Pi Universe Hub Title Card -->
      <div class="title-card shadow-xl rounded-2xl mb-6">
        <h1>Pi Universe Hub</h1>
        <p>Khám phá Tương Lai của Pi</p>
      </div>

      <!-- Toast Notification -->
      <div
        id="toast"
        class="fixed top-4 right-4 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg"
      >
        <span id="toastMessage"></span>
      </div>

      <!-- Card Section -->
      <div class="card shadow-xl rounded-2xl p-6 mb-6">
        <div class="flex items-center mb-4">
          <img
            id="avatar"
            src="https://picsum.photos/80"
            alt="Avatar"
            class="avatar mr-4"
            loading="lazy"
          />
          <div class="flex-1">
            <h2 id="userName" class="text-xl font-bold">Tên của bạn</h2>
          </div>
        </div>
        <div class="mb-4">
          <p class="text-sm text-gray-500">
            Ví: <span id="walletAddress" class="break-words text-sm text-gray-500">Chưa nhập địa chỉ ví</span>
          </p>
          <p class="text-sm text-gray-500 mt-1">
            Số dư: <span id="balanceDisplay">Chưa kiểm tra</span>
          </p>
        </div>
        <div class="flex space-x-2">
          <button
            onclick="copyWalletAddress()"
            class="flex-1 bg-indigo-500 text-white py-2 rounded-lg btn hover:bg-indigo-600"
          >
            Sao chép ví
          </button>
          <button
            onclick="checkBalance()"
            class="flex-1 bg-green-500 text-white py-2 rounded-lg btn hover:bg-green-600"
          >
            Kiểm tra số dư
          </button>
        </div>
      </div>

      <!-- Check-in Section -->
      <div class="card shadow-xl rounded-2xl p-6 mb-6">
        <h3 class="text-lg font-bold mb-4">Khám phá Vũ trụ Pi</h3>
        <div class="flex items-center mb-4">
          <img
            id="planetImage"
            src="https://picsum.photos/80"
            alt="Hành tinh"
            class="avatar mr-4"
            loading="lazy"
          />
          <div>
            <p class="text-sm font-bold">
              Hành tinh: <span id="planetName">Chưa khám phá</span>
            </p>
            <p class="text-sm text-gray-500" id="planetDescription">
              Bắn thiên thạch để tích lũy năng lượng và khám phá vũ trụ!
            </p>
          </div>
        </div>
        <p class="text-sm mb-2">Cấp độ: <span id="userLevel">0</span></p>
        <p class="text-sm mb-4">
          Tiến độ: <span id="checkInProgress">0/15 ngày để lên cấp 1</span>
        </p>
        <p class="text-sm mb-4">
          Số dư: <span id="pidogeBalance">0</span> PiDoge, <span id="ttBalance">0</span> TT
        </p>
        <!-- Referral Section -->
        <div class="mb-4">
          <h4 class="text-md font-bold mb-2">Giới thiệu bạn bè</h4>
          <input
            id="referralCodeInput"
            type="text"
            class="w-full p-2 border rounded mb-2 focus:ring-2 focus:ring-indigo-300 transition-all duration-200"
            placeholder="Nhập mã mời (VD: 002)"
          />
          <button
            onclick="submitReferral()"
            class="w-full bg-indigo-500 text-white py-2 rounded-lg btn hover:bg-indigo-600"
          >
            Gửi mã mời
          </button>
        </div>
        <div class="sound-toggle-container mb-4">
          <p class="text-sm timer" id="gameTimer">Thời gian: 10s</p>
          <button id="soundToggle" class="btn" aria-label="Bật/tắt âm thanh">
            <svg id="soundIcon" viewBox="0 0 24 24">
              <path fill="currentColor" d="M3 9v6h4l5 5V4L7 9H3zm13.5 3A4.5 4.5 0 0014 7.97v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77 0-4.28-2.99-7.86-7-8.77z"/>
            </svg>
          </button>
        </div>
        <canvas id="gameCanvas" width="200" height="200" class="mx-auto mb-4"></canvas>
        <div class="energy-bar-container mb-4">
          <div id="energyBar" class="energy-bar">
            <span id="energyPercentage" class="energy-percentage">0%</span>
          </div>
        </div>
        <h4 class="text-md font-bold mt-4 mb-2">Lịch sử điểm danh</h4>
        <div id="checkInHistory" class="text-sm text-gray-500"></div>
      </div>

      <!-- Chart Section -->
      <div class="card shadow-xl rounded-2xl p-6 mb-6">
        <h3 class="text-lg font-bold mb-4">Giá Pi (USD)</h3>
        <div id="tradingview_chart"></div>
      </div>

      <!-- Safety Check Section -->
      <div class="card shadow-xl rounded-2xl p-6 mb-6">
        <h3 class="text-lg font-bold mb-4">Kiểm tra Web/Ứng dụng</h3>
        <select
          id="checkType"
          class="w-full p-2 border rounded mb-4 focus:ring-2 focus:ring-indigo-300 transition-all duration-200"
        >
          <option value="website">Trang web</option>
          <option value="app">Ứng dụng</option>
        </select>
        <input
          id="safetyUrlInput"
          type="text"
          class="w-full p-2 border rounded mb-4 focus:ring-2 focus:ring-indigo-300 transition-all duration-200"
          placeholder="Nhập URL (ví dụ: https://example.com hoặc link Google Play)"
        />
        <div class="flex space-x-2">
          <button
            onclick="checkSafety()"
            id="checkButton"
            class="flex-1 bg-indigo-500 text-white py-2 rounded-lg btn hover:bg-indigo-600"
          >
            Kiểm tra
          </button>
          <button
            onclick="clearForm()"
            class="flex-1 bg-gray-300 text-gray-800 py-2 rounded-lg btn hover:bg-gray-400"
          >
            Xóa
          </button>
        </div>
        <div id="loadingSpinner" class="spinner mx-auto mt-4"></div>
        <div id="safetyResult" class="mt-4 hidden">
          <p class="text-sm font-bold flex items-center">
            Kết quả: <span id="safetyStatus" class="ml-2"></span>
            <svg id="statusIcon" class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
          </p>
          <p class="text-sm">Điểm tin cậy: <span id="safetyScore"></span>/100</p>
          <p class="text-sm">Cảnh báo: <span id="safetyWarnings"></span></p>
        </div>
      </div>

      <!-- Support Section -->
      <div class="card shadow-xl rounded-2xl p-6">
        <h3 class="text-lg font-bold mb-4">Hỗ trợ</h3>
        <p class="text-sm text-gray-600 mb-2">
          Liên hệ: <a href="mailto:support@example.com" class="text-indigo-500 hover:underline">support@example.com</a>
        </p>
        <p class="text-sm text-gray-600 mb-4">
          Hotline: <a href="tel:+84987654321" class="text-indigo-500 hover:underline">+84 987 654 321</a>
        </p>
        <h4 class="text-md font-bold mb-2">Video hướng dẫn</h4>
        <div class="relative" style="padding-top: 56.25%">
          <iframe
            class="absolute top-0 left-0 w-full h-full rounded-lg"
            src="https://www.youtube.com/embed/dQw4w9WgXcQ"
            title="Hướng dẫn sử dụng ví Pi"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen
            loading="lazy"
          ></iframe>
        </div>
      </div>

      <!-- Withdraw Modal -->
      <div
        id="withdrawModal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden modal"
      >
        <div class="modal-content rounded-lg p-6 w-11/12 max-w-sm">
          <h3 class="text-lg font-bold mb-4">Rút Pi</h3>
          <p class="text-sm text-gray-600 mb-4">
            Số dư hiện tại: <span id="withdrawBalance">0 Pi</span>
          </p>
          <input
            id="withdrawAmount"
            type="number"
            step="0.01"
            min="0"
            class="w-full p-2 border rounded mb-4 focus:ring-2 focus:ring-indigo-300 transition-all duration-200"
            placeholder="Số lượng Pi (tối thiểu 1$)"
          />
          <input
            id="withdrawPasswordInput"
            type="password"
            class="w-full p-2 border rounded mb-4 focus:ring-2 focus:ring-indigo-300 transition-all duration-200"
            placeholder="Nhập mật khẩu"
          />
          <div class="flex justify-end space-x-2">
            <button
              onclick="hideWithdrawModal()"
              class="bg-gray-300 text-gray-800 py-2 px-4 rounded btn hover:bg-gray-400"
            >
              Hủy
            </button>
            <button
              onclick="withdrawPi()"
              class="bg-red-500 text-white py-2 px-4 rounded btn hover:bg-red-600"
            >
              Rút
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Inline JavaScript -->
    <script>
      (function () {
        // Firebase Configuration
        const firebaseConfig = YOUR_FIREBASE_CONFIG; // Thay bằng firebaseConfig từ Firebase Console
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Member Data
        if (!window.memberData) {
          window.memberData = {
            "001": {
              name: "HOÀNG VĂN MINH",
              avatar: "https://i.imgur.com/6ceGYoC.jpeg",
              wallet_address: "GAB3DTZTDHAQQ2IXO4RDPMYQY3CNZABM6ZGK4HWK55QKRQ6W6QCKRSDQ",
              explorer_link: "https://blockexplorer.minepi.com/mainnet/accounts/GAB3DTZTDHAQQ2IXO4RDPMYQY3CNZABM6ZGK4HWK55QKRQ6W6QCKRSDQ"
            },
            "002": {
              name: "LÊ VĂN HOẰNG",
              avatar: "https://i.imgur.com/bacHB3U.jpeg",
              wallet_address: "GCVBQP2M5AWPLHFLUWX7ZRSE24INWWYEYC2EI3NPQWXIL5WVXXZITGJP",
              explorer_link: "https://blockexplorer.minepi.com/mainnet/accounts/GCVBQP2M5AWPLHFLUWX7ZRSE24INWWYEYC2EI3NPQWXIL5WVXXZITGJP"
            },
            "003": {
              name: "PHẠM THỊ XUÂN",
              avatar: "https://i.imgur.com/FgV7fRT.jpeg",
              wallet_address: "GBDUXC2JUGEVI7N2NGLXB6B3VMUUVNUK6QI4TL5XIB2LIY3U7CDGK3B4",
              explorer_link: "https://blockexplorer.minepi.com/mainnet/accounts/GBDUXC2JUGEVI7N2NGLXB6B3VMUUVNUK6QI4TL5XIB2LIY3U7CDGK3B4"
            },
            "004": {
              name: "LÊ THỊ HƯƠNG",
              avatar: "https://i.imgur.com/qPmerTD.jpeg",
              wallet_address: "GCWRIG2I5BNCTN5HXSMAYPQC45MRY7BQFX6AUUPAKTGACFZLBDGJG7I3",
              explorer_link: "https://blockexplorer.minepi.com/mainnet/accounts/GCWRIG2I5BNCTN5HXSMAYPQC45MRY7BQFX6AUUPAKTGACFZLBDGJG7I3"
            },
            "005": {
              name: "LÊ TRỌNG KHOA",
              avatar: "https://i.imgur.com/h2G4JTA.jpeg",
              wallet_address: "GDMBS366RAH5STHNFCH3QWLV4VNK2U77TGFU7WEG66ZFGMHGOWZCHDOZ",
              explorer_link: "https://blockexplorer.minepi.com/mainnet/accounts/GDMBS366RAH5STHNFCH3QWLV4VNK2U77TGFU7WEG66ZFGMHGOWZCHDOZ"
            },
            "006": {
              name: "HOÀNG VĂN TRỤ",
              avatar: "https://i.imgur.com/wNUTVEz.jpeg",
              wallet_address: "GC4QQVU6A4EWTNCW4235WUOQ5FHKBOF57RKO2EPTIXDJKRYTLXZOHSGN",
              explorer_link: "https://blockexplorer.minepi.com/mainnet/accounts/GC4QQVU6A4EWTNCW4235WUOQ5FHKBOF57RKO2EPTIXDJKRYTLXZOHSGN"
            },
            "007": {
              name: "MINH TRANG",
              avatar: "https://i.imgur.com/HskgNhC.jpeg",
              wallet_address: "GD7M2UZCORSH4AJUJJN2V56MAA33OCIMYMRJ6OXMBQPG5T2FJ4OZ6TA6",
              explorer_link: "https://blockexplorer.minepi.com/mainnet/accounts/GD7M2UZCORSH4AJUJJN2V56MAA33OCIMYMRJ6OXMBQPG5T2FJ4OZ6TA6"
            },
            "008": {
              name: "LÊ THỊ HÀ",
              avatar: "https://i.imgur.com/zAX7aF4.jpeg",
              wallet_address: "GAL4V2DVKA437NPZT2B6NEQA7AJ4BE53OCKQUXNJ44G3Z3IJF3BGZ7SS",
              explorer_link: "https://blockexplorer.minepi.com/mainnet/accounts/GAL4V2DVKA437NPZT2B6NEQA7AJ4BE53OCKQUXNJ44G3Z3IJF3BGZ7SS"
            },
            "009": {
              name: "LÊ THỊ HỒNG",
              avatar: "https://i.imgur.com/E44n0YR.jpeg",
              wallet_address: "GDSTSA7GBFL4BXWQMUAJ264LSG3XGBYIPGOW62H4TOTX3F3LCMDSKEHC",
              explorer_link: "https://blockexplorer.minepi.com/mainnet/accounts/GDSTSA7GBFL4BXWQMUAJ264LSG3XGBYIPGOW62H4TOTX3F3LCMDSKEHC"
            }
          };
        }

        // Planet Data
        const planets = [
          {
            level: 0,
            name: "Chưa khám phá",
            image: "https://i.imgur.com/xLt0X9f.jpeg",
            description: "Bắn thiên thạch để tích lũy năng lượng và khám phá vũ trụ!"
          },
          {
            level: 1,
            name: "Hành tinh PiDoge",
            image: "https://i.imgur.com/8gDHqeY.jpeg",
            description: "Nơi cư dân đào PiDoge với niềm vui và năng lượng tích cực."
          },
          {
            level: 2,
            name: "Hành tinh TT",
            image: "https://i.imgur.com/27lNYa5.jpeg",
            description: "Một hành tinh bí ẩn, nơi TT là nguồn năng lượng chính."
          },
          {
            level: 3,
            name: "Hành tinh Nova",
            image: "https://i.imgur.com/ccV8NTe.jpeg",
            description: "Hành tinh rực rỡ với những ngôi sao sáng dẫn lối."
          },
          {
            level: 4,
            name: "Hành tinh Nebula",
            image: "https://i.imgur.com/CJCOZtV.jpeg",
            description: "Vùng không gian đầy sương mù và bí ẩn vũ trụ."
          },
          {
            level: 5,
            name: "Hành tinh Quasar",
            image: "https://i.imgur.com/LnO70Wb.jpeg",
            description: "Nguồn năng lượng mạnh mẽ, tỏa sáng khắp thiên hà."
          },
          {
            level: 6,
            name: "Hành tinh Pulsar",
            image: "https://images.unsplash.com/photo-1614314069749-7c2603923c3a?auto=format&fit=crop&w=80",
            description: "Hành tinh nhấp nháy với nhịp điệu của vũ trụ."
          },
          {
            level: 7,
            name: "Hành tinh Genesis",
            image: "https://images.unsplash.com/photo-1614732621357-6b6e47e9a2f8?auto=format&fit=crop&w=80",
            description: "Cội nguồn của Vũ trụ Pi, nơi mọi thứ bắt đầu."
          }
        ];

        // Mini-Game Logic
        let energyLevel = 0;
        let gameActive = false;
        let timeLeft = 10;
        let timerInterval = null;
        let soundEnabled = true;
        let currentUserId = null;

        // Audio
        const shootSound = new Audio('/assets/audio/shoot.mp3');
        const explodeSound = new Audio('/assets/audio/explode.mp3');

        // Canvas Setup
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const asteroid = {
          x: 100,
          y: 100,
          radius: 20,
          image: new Image()
        };
        asteroid.image.src = 'https://i.imgur.com/ccV8NTe.jpeg'; // Asteroid image

        function drawGame() {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(asteroid.image, asteroid.x - asteroid.radius, asteroid.y - asteroid.radius, asteroid.radius * 2, asteroid.radius * 2);
        }

        function resetAsteroid() {
          asteroid.x = Math.random() * (canvas.width - 2 * asteroid.radius) + asteroid.radius;
          asteroid.y = Math.random() * (canvas.height - 2 * asteroid.radius) + asteroid.radius;
        }

        async function startGame() {
          if (gameActive) return;
          const userDoc = await db.collection("users").doc(currentUserId).get();
          const userData = userDoc.data();
          const lastCheckIn = userData.lastCheckIn ? userData.lastCheckIn.toDate().getTime() : 0;
          const now = new Date().getTime();
          const oneDay = 24 * 60 * 60 * 1000;

          if (lastCheckIn && now - lastCheckIn < oneDay) {
            showToast("Bạn chỉ có thể điểm danh mỗi 24 giờ!", "error");
            return;
          }

          gameActive = true;
          timeLeft = 10;
          energyLevel = 0;
          document.getElementById("energyBar").style.width = "0%";
          document.getElementById("energyPercentage").textContent = "0%";
          document.getElementById("gameTimer").textContent = `Thời gian: ${timeLeft}s`;
          timerInterval = setInterval(updateTimer, 1000);
          resetAsteroid();
          drawGame();
        }

        function updateTimer() {
          timeLeft--;
          document.getElementById("gameTimer").textContent = `Thời gian: ${timeLeft}s`;
          if (timeLeft <= 0) {
            clearInterval(timerInterval);
            gameActive = false;
            showToast("Hết thời gian, thử lại sau 5 giây!", "error");
            resetEnergyBar();
            setTimeout(() => {
              document.getElementById("gameTimer").textContent = "Thời gian: 10s";
            }, 5000);
          }
        }

        canvas.addEventListener("click", (event) => {
          if (!gameActive) {
            startGame();
            return;
          }
          const rect = canvas.getBoundingClientRect();
          const clickX = event.clientX - rect.left;
          const clickY = event.clientY - rect.top;
          const distance = Math.sqrt((clickX - asteroid.x) ** 2 + (clickY - asteroid.y) ** 2);
          if (distance < asteroid.radius) {
            chargeEnergy();
            resetAsteroid();
            drawGame();
          }
        });

        function chargeEnergy() {
          const energyBar = document.getElementById("energyBar");
          const energyPercentage = document.getElementById("energyPercentage");
          const planetImage = document.getElementById("planetImage");

          energyLevel += 5;
          if (energyLevel > 100) energyLevel = 100;

          energyBar.style.width = `${energyLevel}%`;
          energyPercentage.textContent = `${energyLevel}%`;

          // Planet Interaction
          planetImage.classList.add("shake");
          setTimeout(() => planetImage.classList.remove("shake"), 200);
          if (energyLevel >= 50) {
            planetImage.classList.add("glow");
          } else {
            planetImage.classList.remove("glow");
          }

          // Play Sound
          if (soundEnabled) {
            shootSound.currentTime = 0;
            shootSound.play().catch(() => console.warn("Không thể phát âm thanh bắn"));
          }

          if (energyLevel >= 100) {
            energyBar.classList.add("full");
            completeCheckIn();
          }
        }

        async function completeCheckIn() {
          clearInterval(timerInterval);
          gameActive = false;

          // Create explosion effect
          const explosion = document.createElement("div");
          explosion.className = "explosion";
          document.body.appendChild(explosion);
          setTimeout(() => explosion.remove(), 500);

          // Play explosion sound
          if (soundEnabled) {
            explodeSound.currentTime = 0;
            explodeSound.play().catch(() => console.warn("Không thể phát âm thanh nổ"));
          }

          // Check-in logic
          const now = new Date();
          let pidogeReward = Math.floor(Math.random() * (100 - 50 + 1)) + 50;
          let ttReward = 0.7;

          // Update user data
          const userRef = db.collection("users").doc(currentUserId);
          const userDoc = await userRef.get();
          let userData = userDoc.data();
          const pidogeBalance = (userData.pidogeBalance || 0) + pidogeReward;
          const ttBalance = (userData.ttBalance || 0) + ttReward;
          const checkInCount = (userData.checkInCount || 0) + 1;
          const checkInHistory = userData.checkInHistory || [];
          checkInHistory.push({ date: now.toLocaleString("vi-VN"), pidoge: pidogeReward, tt: ttReward });

          // Referral bonus
          let referralBonusMessage = "";
          if (userData.referredBy) {
            const referrerId = userData.referredBy;
            const referrerRef = db.collection("users").doc(referrerId);
            const referrerDoc = await referrerRef.get();
            if (referrerDoc.exists) {
              const referrerData = referrerDoc.data();
              const referrerLastCheckIn = referrerData.lastCheckIn ? referrerData.lastCheckIn.toDate() : null;
              const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
              const referrerCheckInDate = referrerLastCheckIn ? new Date(referrerLastCheckIn.getFullYear(), referrerLastCheckIn.getMonth(), referrerLastCheckIn.getDate()) : null;

              if (referrerCheckInDate && referrerCheckInDate.getTime() === today.getTime()) {
                const bonusPidoge = Math.floor(pidogeReward * 0.11);
                const bonusTT = ttReward * 0.11;
                pidogeReward += bonusPidoge;
                ttReward += bonusTT;

                // Update referrer
                await referrerRef.update({
                  pidogeBalance: (referrerData.pidogeBalance || 0) + bonusPidoge,
                  ttBalance: (referrerData.ttBalance || 0) + bonusTT,
                  checkInHistory: [...referrerData.checkInHistory, {
                    date: now.toLocaleString("vi-VN"),
                    pidoge: bonusPidoge,
                    tt: bonusTT,
                    note: "Thưởng giới thiệu"
                  }]
                });

                referralBonusMessage = ` +${bonusPidoge} PiDoge, +${bonusTT} TT (thưởng giới thiệu)`;
              }
            }
          }

          // Save to Firestore
          await userRef.set({
            pidogeBalance,
            ttBalance,
            checkInCount,
            checkInHistory,
            lastCheckIn: now,
            referredBy: userData.referredBy || null
          }, { merge: true });

          // Update UI
          const levelMilestones = [0, 15, 35, 60, 100, 160, 220, 300];
          let userLevel = 0;
          for (let i = 0; i < levelMilestones.length; i++) {
            if (checkInCount >= levelMilestones[i]) {
              userLevel = i;
            } else {
              break;
            }
          }

          document.getElementById("pidogeBalance").textContent = pidogeBalance;
          document.getElementById("ttBalance").textContent = ttBalance;
          document.getElementById("userLevel").textContent = userLevel;
          document.getElementById("checkInProgress").textContent = `${checkInCount}/${levelMilestones[userLevel + 1] || 300} ngày để lên cấp ${userLevel + 1}`;

          const currentPlanet = planets[userLevel];
          document.getElementById("planetName").textContent = currentPlanet.name;
          document.getElementById("planetDescription").textContent = currentPlanet.description;
          document.getElementById("planetImage").src = currentPlanet.image;

          updateCheckInHistory();
          showToast(`Điểm danh thành công! Nhận ${pidogeReward} PiDoge, ${ttReward} TT${referralBonusMessage}`);
          resetEnergyBar();
        }

        function resetEnergyBar() {
          energyLevel = 0;
          gameActive = false;
          clearInterval(timerInterval);
          const energyBar = document.getElementById("energyBar");
          const energyPercentage = document.getElementById("energyPercentage");
          const planetImage = document.getElementById("planetImage");
          energyBar.style.width = "0%";
          energyPercentage.textContent = "0%";
          energyBar.classList.remove("full");
          planetImage.classList.remove("glow");
          document.getElementById("gameTimer").textContent = "Thời gian: 10s";
          ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // Referral Submission
        async function submitReferral() {
          const referralCode = document.getElementById("referralCodeInput").value.trim();
          if (!referralCode) {
            showToast("Vui lòng nhập mã mời!", "error");
            return;
          }
          if (!window.memberData[referralCode]) {
            showToast("Mã mời không hợp lệ!", "error");
            return;
          }
          if (referralCode === currentUserId) {
            showToast("Bạn không thể tự mời chính mình!", "error");
            return;
          }

          try {
            await db.collection("users").doc(currentUserId).update({
              referredBy: referralCode
            });
            showToast("Đã gửi mã mời thành công!");
            document.getElementById("referralCodeInput").value = "";
          } catch (error) {
            showToast("Lỗi khi gửi mã mời!", "error");
            console.error("Referral error:", error);
          }
        }

        // Sound Toggle
        function initializeSoundToggle() {
          const soundToggle = document.getElementById("soundToggle");
          if (!soundToggle) {
            console.error("Không tìm thấy nút #soundToggle! Kiểm tra HTML đảm bảo phần tử tồn tại.");
            return;
          }
          console.log("Đã tìm thấy #soundToggle, khởi tạo sự kiện");
          function toggleSound() {
            console.log("Nút #soundToggle được chạm, soundEnabled:", soundEnabled);
            soundEnabled = !soundEnabled;
            const soundIcon = document.getElementById("soundIcon");
            soundIcon.innerHTML = soundEnabled
              ? '<path fill="currentColor" d="M3 9v6h4l5 5V4L7 9H3zm13.5 3A4.5 4.5 0 0014 7.97v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77 0-4.28-2.99-7.86-7-8.77z"/>'
              : '<path fill="currentColor" d="M3 9v6h4l5 5V4L7 9H3zm7.5 3c0-1.67-1.33-3-3-3v6c1.67 0 3-1.33 3-3zm3.5-8.77v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77 0-4.28-2.99-7.86-7-8.77zM15 12l5-5m0 5l-5-5"/>';
          }
          soundToggle.addEventListener("click", toggleSound);
          soundToggle.addEventListener("touchstart", (e) => {
            e.preventDefault();
            toggleSound();
          });
          soundToggle.style.display = "flex";
          soundToggle.style.opacity = "1";
          soundToggle.style.visibility = "visible";
          console.log("Đã hiển thị #soundToggle với display: flex, opacity: 1");
        }

        // Update Check-in History
        async function updateCheckInHistory() {
          const historyDiv = document.getElementById("checkInHistory");
          const userDoc = await db.collection("users").doc(currentUserId).get();
          const checkInHistory = userDoc.data().checkInHistory || [];
          historyDiv.innerHTML = checkInHistory.length
            ? checkInHistory
                .map((entry) => `<p>${entry.date}: ${entry.pidoge} PiDoge, ${entry.tt} TT ${entry.note || ""}</p>`)
                .join("")
            : "Chưa có lịch sử điểm danh.";
        }

        // Initialize Check-in
        async function initCheckIn() {
          const planetImage = document.getElementById("planetImage");
          planetImage.onerror = () => {
            planetImage.src = "https://i.imgur.com/ccV8NTe.jpeg";
          };
          const userDoc = await db.collection("users").doc(currentUserId).get();
          let userData = userDoc.data() || {
            pidogeBalance: 0,
            ttBalance: 0,
            checkInCount: 0,
            checkInHistory: [],
            lastCheckIn: null,
            referredBy: null
          };

          // Initialize user if not exists
          if (!userDoc.exists) {
            await db.collection("users").doc(currentUserId).set(userData);
          }

          const pidogeBalance = userData.pidogeBalance || 0;
          const ttBalance = userData.ttBalance || 0;
          const checkInCount = userData.checkInCount || 0;
          const levelMilestones = [0, 15, 35, 60, 100, 160, 220, 300];
          let userLevel = 0;
          for (let i = 0; i < levelMilestones.length; i++) {
            if (checkInCount >= levelMilestones[i]) {
              userLevel = i;
            } else {
              break;
            }
          }

          document.getElementById("pidogeBalance").textContent = pidogeBalance;
          document.getElementById("ttBalance").textContent = ttBalance;
          document.getElementById("userLevel").textContent = userLevel;
          document.getElementById("checkInProgress").textContent = `${checkInCount}/${levelMilestones[userLevel + 1] || 300} ngày để lên cấp ${userLevel + 1}`;

          const currentPlanet = planets[userLevel];
          document.getElementById("planetName").textContent = currentPlanet.name;
          document.getElementById("planetDescription").textContent = currentPlanet.description;
          document.getElementById("planetImage").src = currentPlanet.image;

          updateCheckInHistory();

          // Preload asteroid image
          asteroid.image.onload = () => {
            drawGame();
          };
        }

        // Show Toast Notification
        function showToast(message, type = "success") {
          const toast = document.getElementById("toast");
          const toastMessage = document.getElementById("toastMessage");
          toastMessage.textContent = message;
          toast.classList.remove("bg-green-500", "bg-red-500");
          toast.classList.add(type === "success" ? "bg-green-500" : "bg-red-500");
          toast.classList.remove("hidden");
          toast.classList.add("show");
          setTimeout(() => {
            toast.classList.remove("show");
            toast.classList.add("hidden");
          }, 3000);
        }

        // Load User Data
        async function loadUserData() {
          const urlParams = new URLSearchParams(window.location.search);
          const tagId = urlParams.get("tag_id");
          currentUserId = tagId;
          const userName = document.getElementById("userName");
          const walletAddress = document.getElementById("walletAddress");
          const avatar = document.getElementById("avatar");

          if (tagId && window.memberData[tagId]) {
            const member = window.memberData[tagId];
            userName.textContent = member.name;
            walletAddress.textContent = member.wallet_address;
            avatar.src = member.avatar;
          } else {
            userName.textContent = "Không tìm thấy thông tin";
            walletAddress.textContent = "Không tìm thấy địa chỉ ví";
            avatar.src = "https://picsum.photos/80";
            showToast("Tag ID không hợp lệ!", "error");
          }

          avatar.onload = () => {
            avatar.classList.add("loaded");
          };
          avatar.onerror = () => {
            console.warn(`Không thể tải hình ảnh: ${avatar.src}`);
            if (avatar.src !== "https://picsum.photos/seed/fallback/80") {
              avatar.src = "https://picsum.photos/seed/fallback/80";
            } else {
              showToast("Không thể tải hình ảnh đại diện!", "error");
              avatar.classList.add("loaded");
            }
          };
        }

        // Auto-check Balance from URL
        function autoCheckBalanceFromURL() {
          const urlParams = new URLSearchParams(window.location.search);
          const walletAddress = urlParams.get("wallet");
          if (walletAddress) {
            document.getElementById("walletAddress").textContent = walletAddress;
            checkBalance();
          }
        }

        // Check Balance
        function checkBalance() {
          const walletAddress = document.getElementById("walletAddress").textContent;
          if (!walletAddress || walletAddress === "Không tìm thấy địa chỉ ví") {
            showToast("Không có địa chỉ ví để kiểm tra!", "error");
            return;
          }
          const explorerUrl = `https://blockexplorer.minepi.com/mainnet/accounts/${walletAddress}`;
          window.location.href = explorerUrl;
        }

        // Copy Wallet Address
        function copyWalletAddress() {
          const walletAddress = document.getElementById("walletAddress").textContent;
          if (walletAddress === "Không tìm thấy địa chỉ ví") {
            showToast("Không có địa chỉ ví để sao chép!", "error");
            return;
          }
          navigator.clipboard
            .writeText(walletAddress)
            .then(() => {
              showToast("Đã sao chép địa chỉ ví!");
            })
            .catch(() => {
              showToast("Không thể sao chép địa chỉ ví!", "error");
            });
        }

        // Show Withdraw Modal
        function showWithdrawModal() {
          const withdrawModal = document.getElementById("withdrawModal");
          withdrawModal.classList.remove("hidden");
          withdrawModal.classList.add("show");
        }

        // Hide Withdraw Modal
        function hideWithdrawModal() {
          const withdrawModal = document.getElementById("withdrawModal");
          withdrawModal.classList.remove("show");
          withdrawModal.classList.add("hidden");
        }

        // Withdraw Pi
        function withdrawPi() {
          const amount = parseFloat(document.getElementById("withdrawAmount").value);
          const password = document.getElementById("withdrawPasswordInput").value;

          if (!amount || amount < 0.01) {
            showToast("Số lượng Pi phải lớn hơn 0 và tối thiểu 1$!", "error");
            return;
          }

          if (!password) {
            showToast("Vui lòng nhập mật khẩu!", "error");
            return;
          }

          showToast("Đang xử lý rút Pi...");
          setTimeout(() => {
            showToast("Yêu cầu rút Pi đã được gửi!");
            hideWithdrawModal();
          }, 1500);
        }

        // Safety Check
        function checkSafety() {
          const checkButton = document.getElementById("checkButton");
          const loadingSpinner = document.getElementById("loadingSpinner");
          const safetyResult = document.getElementById("safetyResult");
          const safetyStatus = document.getElementById("safetyStatus");
          const safetyScore = document.getElementById("safetyScore");
          const safetyWarnings = document.getElementById("safetyWarnings");
          const safetyUrl = document.getElementById("safetyUrlInput").value;

          if (!safetyUrl) {
            showToast("Vui lòng nhập URL để kiểm tra!", "error");
            return;
          }

          checkButton.disabled = true;
          loadingSpinner.style.display = "block";
          safetyResult.classList.add("hidden");

          setTimeout(() => {
            loadingSpinner.style.display = "none";
            safetyResult.classList.remove("hidden");

            const isSafe = Math.random() > 0.5;
            safetyResult.classList.remove("safe", "unsafe");
            safetyResult.classList.add(isSafe ? "safe" : "unsafe");
            safetyStatus.textContent = isSafe ? "An toàn" : "Không an toàn";
            safetyScore.textContent = isSafe ? "85" : "30";
            safetyWarnings.textContent = isSafe
              ? "Không có cảnh báo"
              : "Trang web có thể không đáng tin cậy";

            checkButton.disabled = false;
            showToast(
              isSafe ? "Kiểm tra thành công: An toàn!" : "Kiểm tra thành công: Không an toàn!",
              isSafe ? "success" : "error"
            );
          }, 1500);
        }

        // Clear Safety Check Form
        function clearForm() {
          document.getElementById("safetyUrlInput").value = "";
          document.getElementById("safetyResult").classList.add("hidden");
          showToast("Đã xóa biểu mẫu!");
        }

        // Initialize on Page Load
        document.addEventListener("DOMContentLoaded", async () => {
          await loadUserData();
          await initCheckIn();
          initializeSoundToggle();
          autoCheckBalanceFromURL();

          // Lazy load TradingView Widget
          const tradingViewSection = document.getElementById("tradingview_chart");
          const observer = new IntersectionObserver(
            (entries) => {
              if (entries[0].isIntersecting) {
                new TradingView.widget({
                  width: "100%",
                  height: 250,
                  symbol: "OKX:PIUSDT",
                  interval: "D",
                  timezone: "Etc/UTC",
                  theme: "light",
                  style: "1",
                  locale: "en",
                  toolbar_bg: "#f1f3f6",
                  enable_publishing: false,
                  allow_symbol_change: true,
                  container_id: "tradingview_chart"
                });
                observer.disconnect();
              }
            },
            { rootMargin: "100px" }
          );
          observer.observe(tradingViewSection);
        });
      })();
    </script>
  </body>
</html>
