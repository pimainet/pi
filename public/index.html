<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>V√≠ Pi - Huy·ªÅn B√≠ Sci-Fi</title>
    <!-- Google Fonts for Inter -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- TradingView Widget -->
    <script src="https://s3.tradingview.com/tv.js"></script>
    <!-- Local CSS -->
    <style>
      /* Smooth Scroll */
      html {
        scroll-behavior: smooth;
        overscroll-behavior: contain;
      }

      /* Mystical Gradient Background */
      body {
        background: linear-gradient(135deg, #000000, #4c1d95, #000000);
        position: relative;
        overflow-x: hidden;
        font-family: "Inter", sans-serif;
        min-height: 100vh;
        color: #e0e0e0;
        animation: mysticGlow 10s ease infinite;
      }

      @keyframes mysticGlow {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      /* Glowing Overlay Effect */
      body::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
          circle,
          rgba(250, 204, 21, 0.1) 0%,
          transparent 70%
        );
        opacity: 0.3;
        pointer-events: none;
        animation: flicker 3s ease-in-out infinite;
      }

      @keyframes flicker {
        0%,
        100% {
          opacity: 0.3;
        }
        50% {
          opacity: 0.5;
        }
      }

      /* Glassmorphism Effect for Cards with Mystical Glow */
      .card {
        background: rgba(76, 29, 149, 0.9);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(250, 204, 21, 0.3);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        will-change: transform, box-shadow;
        border-radius: 16px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3),
          0 0 10px rgba(250, 204, 21, 0.2);
        position: relative;
        overflow: hidden;
      }
      .card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4),
          0 0 15px rgba(250, 204, 21, 0.4);
      }
      .card::after {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(250, 204, 21, 0.2) 0%,
          transparent 70%
        );
        opacity: 0;
        transition: opacity 0.5s ease;
      }
      .card:hover::after {
        opacity: 1;
      }

      /* Sci-Fi Button with Neon Glow and Pulse */
      .btn {
        position: relative;
        overflow: hidden;
        transition: transform 0.2s ease, box-shadow 0.3s ease;
        will-change: transform, box-shadow;
        border-radius: 10px;
        background: linear-gradient(45deg, #00f0ff, #6b00ff);
        color: #fff;
        text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        border: 2px solid transparent;
        box-shadow: 0 0 10px rgba(0, 240, 255, 0.5);
        animation: neonPulse 2s ease infinite;
      }
      @keyframes neonPulse {
        0%,
        100% {
          box-shadow: 0 0 10px rgba(0, 240, 255, 0.5),
            0 0 15px rgba(107, 0, 255, 0.3);
        }
        50% {
          box-shadow: 0 0 15px rgba(0, 240, 255, 0.8),
            0 0 20px rgba(107, 0, 255, 0.5);
        }
      }
      .btn:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(0, 240, 255, 0.7),
          0 0 20px rgba(107, 0, 255, 0.6);
        animation: none;
        border-color: #00f0ff;
      }
      .btn::before {
        content: "";
        position: absolute;
        top: -2px;
        left: -2px;
        width: calc(100% + 4px);
        height: calc(100% + 4px);
        border: 2px solid transparent;
        border-radius: 12px;
        background: linear-gradient(45deg, #00f0ff, #6b00ff, #00f0ff) border-box;
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      .btn:hover::before {
        opacity: 1;
      }
      .btn::after {
        content: "";
        position: absolute;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.4),
          transparent
        );
        width: 100%;
        height: 100%;
        top: 0;
        left: -100%;
        transition: left 0.5s ease;
      }
      .btn:hover::after {
        left: 100%;
      }
      .btn:disabled {
        background: linear-gradient(45deg, #4b5563, #1f2937);
        box-shadow: none;
        animation: none;
        cursor: not-allowed;
        opacity: 0.6;
      }
      .btn:disabled:hover {
        transform: none;
        border-color: transparent;
      }

      /* Spinner Animation with Glow */
      .spinner {
        border: 4px solid #e0e0e0;
        border-top: 4px solid #facc15;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        animation: spin 1s linear infinite;
        display: none;
        box-shadow: 0 0 8px rgba(250, 204, 21, 0.5);
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Safety Status Colors with Mystical Glow */
      .safe {
        color: #34d399;
        text-shadow: 0 0 6px rgba(52, 211, 153, 0.4);
      }
      .unsafe {
        color: #f87171;
        text-shadow: 0 0 6px rgba(248, 113, 113, 0.4);
      }

      /* Modal Animation with Mystical Touch */
      .modal.show {
        opacity: 1;
        transform: scale(1);
      }
      .modal .modal-content {
        background: rgba(76, 29, 149, 0.95);
        backdrop-filter: blur(10px);
        transform: scale(0.85);
        transition: transform 0.3s ease, opacity 0.3s ease;
        border-radius: 14px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4),
          0 0 10px rgba(250, 204, 21, 0.3);
      }
      .modal.show .modal-content {
        transform: scale(1);
        opacity: 1;
      }

      /* Toast Animation with Glow */
      #toast.show {
        transform: translateX(0);
        opacity: 1;
      }
      #toast {
        transition: transform 0.3s ease, opacity 0.3s ease;
        transform: translateX(100%);
        opacity: 0;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3),
          0 0 8px rgba(250, 204, 21, 0.3);
      }

      /* Input Focus Animation with Mystic Glow */
      input:focus,
      select:focus {
        box-shadow: 0 0 8px rgba(250, 204, 21, 0.5);
        border-color: #facc15;
      }

      /* Avatar Styles with Ethereal Effect */
      .avatar {
        width: 64px;
        height: 64px;
        border-radius: 8px;
        border: 2px solid transparent;
        object-fit: cover;
        transition: all 0.3s ease;
        opacity: 0;
        will-change: transform, box-shadow;
      }
      .avatar.loaded {
        opacity: 1;
      }
      .avatar:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3),
          0 0 10px rgba(250, 204, 21, 0.5);
        border-color: #facc15;
      }

      /* Text Colors */
      .text-gray-500 {
        color: #d1d5db;
      }
      .text-gray-600 {
        color: #9ca3af;
      }
      a {
        color: #facc15;
      }
      #userName,
      h3,
      h4 {
        color: #e0e0e0;
        text-shadow: 0 0 5px rgba(250, 204, 21, 0.3);
      }
      #walletAddress,
      #balanceDisplay,
      #safetyResult,
      #safetyStatus,
      #safetyScore,
      #safetyWarnings,
      #pidogeBalance,
      #ttBalance,
      #checkInStatus,
      #referralCode,
      #referralRewards,
      .text-sm {
        color: #d1d5db;
      }

      /* Adventure Section Styles */
      #adventureSection {
        position: relative;
      }
      #adventureSection::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
          circle,
          rgba(250, 204, 21, 0.2) 0%,
          transparent 70%
        );
        opacity: 0.3;
        pointer-events: none;
      }
      #levelProgress {
        background: rgba(0, 0, 0, 0.5);
        border-radius: 8px;
        height: 8px;
        position: relative;
        overflow: hidden;
      }
      #levelProgressBar {
        background: linear-gradient(90deg, #00f0ff, #facc15);
        height: 100%;
        transition: width 0.5s ease;
        box-shadow: 0 0 10px rgba(0, 240, 255, 0.5);
      }
    </style>
  </head>
  <body class="min-h-screen font-sans transition-colors duration-500">
    <div class="container mx-auto p-4 max-w-md">
      <!-- Toast Notification -->
      <div
        id="toast"
        class="fixed top-4 right-4 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg"
      >
        <span id="toastMessage"></span>
      </div>

      <!-- Referral Modal -->
      <div
        id="referralModal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden modal"
      >
        <div class="modal-content rounded-lg p-6 w-11/12 max-w-sm">
          <h3 class="text-lg font-bold mb-4">Nh·∫≠p M√£ Gi·ªõi Thi·ªáu</h3>
          <p class="text-sm text-gray-600 mb-4">
            Nh·∫≠p m√£ gi·ªõi thi·ªáu t·ª´ b·∫°n c·ªßa b·∫°n ƒë·ªÉ b·∫Øt ƒë·∫ßu!
          </p>
          <input
            id="referralCodeInput"
            type="text"
            class="w-full p-2 border rounded mb-4 focus:ring-2 focus:ring-indigo-300 transition-all duration-200"
            placeholder="Nh·∫≠p m√£ (v√≠ d·ª•: 001)"
          />
          <div class="flex justify-end space-x-2">
            <button
              onclick="skipReferral()"
              class="bg-gray-300 text-gray-800 py-2 px-4 rounded btn hover:bg-gray-400"
            >
              B·ªè qua
            </button>
            <button
              onclick="submitReferral()"
              class="bg-indigo-500 text-white py-2 px-4 rounded btn hover:bg-indigo-600"
            >
              X√°c nh·∫≠n
            </button>
          </div>
        </div>
      </div>

      <!-- Card Section -->
      <div class="card shadow-xl rounded-2xl p-6 mb-6">
        <div class="flex items-center mb-4">
          <img
            id="avatar"
            src="https://picsum.photos/80"
            alt="Avatar"
            class="avatar mr-4"
            loading="lazy"
          />
          <div class="flex-1">
            <h2 id="userName" class="text-xl font-bold">T√™n c·ªßa b·∫°n</h2>
          </div>
        </div>
        <div class="mb-4">
          <p class="text-sm text-gray-500">
            V√≠:
            <span id="walletAddress" class="break-words text-sm text-gray-500"
              >Ch∆∞a nh·∫≠p ƒë·ªãa ch·ªâ v√≠</span
            >
          </p>
          <p class="text-sm text-gray-500 mt-1">
            S·ªë d∆∞: <span id="balanceDisplay">Ch∆∞a ki·ªÉm tra</span>
          </p>
          <p class="text-sm text-gray-500 mt-1">
            M√£ gi·ªõi thi·ªáu c·ªßa b·∫°n: <span id="referralCode">Ch∆∞a c√≥</span>
          </p>
        </div>
        <div class="flex space-x-2">
          <button
            onclick="copyWalletAddress()"
            class="flex-1 bg-indigo-500 text-white py-2 rounded-lg btn hover:bg-indigo-600"
          >
            Sao ch√©p v√≠
          </button>
          <button
            onclick="checkBalance()"
            class="flex-1 bg-green-500 text-white py-2 rounded-lg btn hover:bg-green-600"
          >
            Ki·ªÉm tra s·ªë d∆∞
          </button>
        </div>
      </div>

      <!-- Referral Rewards Section -->
      <div class="card shadow-xl rounded-2xl p-6 mb-6">
        <h3 class="text-lg font-bold mb-4">Ph·∫ßn Th∆∞·ªüng Gi·ªõi Thi·ªáu</h3>
        <p class="text-sm mb-2">
          T·ªïng ph·∫ßn th∆∞·ªüng: <span id="referralRewards">0 Pidoge | 0 TT</span>
        </p>
        <button
          onclick="copyReferralLink()"
          class="w-full bg-indigo-500 text-white py-2 rounded-lg btn hover:bg-indigo-600"
        >
          Chia s·∫ª m√£ gi·ªõi thi·ªáu
        </button>
      </div>

      <!-- Adventure Section -->
      <div id="adventureSection" class="card shadow-xl rounded-2xl p-6 mb-6">
        <h3 class="text-lg font-bold mb-4">Phi√™u L∆∞u H√†nh Tinh</h3>
        <div class="mb-4">
          <p class="text-sm">
            C·∫•p b·∫≠c: <span id="currentLevel">Nh√† Du H√†nh M·ªõi üåü</span>
          </p>
          <p id="levelDescription" class="text-sm mt-1 text-gray-600">
            Kh√°m ph√° v≈© tr·ª• m·ªõi v·ªõi tinh th·∫ßn t√≤ m√≤!
          </p>
          <p class="text-sm mt-1">
            L·∫ßn kh√°m ph√°: <span id="checkInCount">0</span>
          </p>
          <p class="text-sm mt-1">
            Ti·∫øn tr√¨nh: <span id="progressText">0/3</span>
          </p>
          <div id="levelProgress" class="mt-2">
            <div id="levelProgressBar" style="width: 0%"></div>
          </div>
        </div>
        <div class="mb-4">
          <p class="text-sm">Pidoge: <span id="pidogeBalance">0</span></p>
          <p class="text-sm mt-1">TT: <span id="ttBalance">0</span></p>
        </div>
        <button
          id="checkInButton"
          onclick="checkIn()"
          class="w-full bg-indigo-500 text-white py-2 rounded-lg btn hover:bg-indigo-600"
        >
          Kh√°m Ph√° H√†nh Tinh
        </button>
        <p id="checkInStatus" class="text-sm mt-2 text-center"></p>
      </div>

      <!-- Chart Section (TradingView Widget) -->
      <div class="card shadow-xl rounded-2xl p-6 mb-6">
        <h3 class="text-lg font-bold mb-4">Gi√° Pi (USD)</h3>
        <div id="tradingview_chart"></div>
      </div>

      <!-- Safety Check Section -->
      <div class="card shadow-xl rounded-2xl p-6 mb-6">
        <h3 class="text-lg font-bold mb-4">Ki·ªÉm tra Web/·ª®ng d·ª•ng</h3>
        <select
          id="checkType"
          class="w-full p-2 border rounded mb-4 focus:ring-2 focus:ring-indigo-300 transition-all duration-200"
        >
          <option value="website">Trang web</option>
          <option value="app">·ª®ng d·ª•ng</option>
        </select>
        <input
          id="safetyUrl"
          type="text"
          class="w-full p-2 border rounded mb-4 focus:ring-2 focus:ring-indigo-300 transition-all duration-200"
          placeholder="Nh·∫≠p URL (v√≠ d·ª•: https://example.com ho·∫∑c link Google Play)"
        />
        <div class="flex space-x-2">
          <button
            onclick="checkSafety()"
            id="checkButton"
            class="flex-1 bg-indigo-500 text-white py-2 rounded-lg btn hover:bg-indigo-600"
          >
            Ki·ªÉm tra
          </button>
          <button
            onclick="clearForm()"
            class="flex-1 bg-gray-300 text-gray-800 py-2 rounded-lg btn hover:bg-gray-400"
          >
            X√≥a
          </button>
        </div>
        <div id="loadingSpinner" class="spinner mx-auto mt-4"></div>
        <div id="safetyResult" class="mt-4 hidden">
          <p class="text-sm font-bold flex items-center">
            K·∫øt qu·∫£: <span id="safetyStatus" class="ml-2"></span>
            <svg
              id="statusIcon"
              class="w-5 h-5 ml-2"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5 13l4 4L19 7"
              />
            </svg>
          </p>
          <p class="text-sm">
            ƒêi·ªÉm tin c·∫≠y: <span id="safetyScore"></span>/100
          </p>
          <p class="text-sm">C·∫£nh b√°o: <span id="safetyWarnings"></span></p>
        </div>
      </div>

      <!-- Support Section -->
      <div class="card shadow-xl rounded-2xl p-6">
        <h3 class="text-lg font-bold mb-4">H·ªó tr·ª£</h3>
        <p class="text-sm text-gray-600 mb-2">
          Li√™n h·ªá:
          <a
            href="mailto:support@example.com"
            class="text-indigo-500 hover:underline"
            >support@example.com</a
          >
        </p>
        <p class="text-sm text-gray-600 mb-4">
          Hotline:
          <a href="tel:+84987654321" class="text-indigo-500 hover:underline"
            >+84 987 654 321</a
          >
        </p>
        <h4 class="text-md font-bold mb-2">Video h∆∞·ªõng d·∫´n</h4>
        <div class="relative" style="padding-top: 56.25%">
          <iframe
            class="absolute top-0 left-0 w-full h-full rounded-lg"
            src="https://www.youtube.com/embed/dQw4w9WgXcQ"
            title="H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng v√≠ Pi"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen
            loading="lazy"
          ></iframe>
        </div>
      </div>

      <!-- Withdraw Modal -->
      <div
        id="withdrawModal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden modal"
      >
        <div class="modal-content rounded-lg p-6 w-11/12 max-w-sm">
          <h3 class="text-lg font-bold mb-4">R√∫t Pi</h3>
          <p class="text-sm text-gray-600 mb-4">
            S·ªë d∆∞ hi·ªán t·∫°i: <span id="withdrawBalance">0 Pi</span>
          </p>
          <input
            id="withdrawAmount"
            type="number"
            step="0.01"
            min="0"
            class="w-full p-2 border rounded mb-4 focus:ring-2 focus:ring-indigo-300 transition-all duration-200"
            placeholder="S·ªë l∆∞·ª£ng Pi (t·ªëi thi·ªÉu 1$)"
          />
          <input
            id="withdrawPassword"
            type="password"
            class="w-full p-2 border rounded mb-4 focus:ring-2 focus:ring-indigo-300 transition-all duration-200"
            placeholder="Nh·∫≠p m·∫≠t kh·∫©u"
          />
          <div class="flex justify-end space-x-2">
            <button
              onclick="hideWithdrawModal()"
              class="bg-gray-300 text-gray-800 py-2 px-4 rounded btn hover:bg-gray-400"
            >
              H·ªßy
            </button>
            <button
              onclick="withdrawPi()"
              class="bg-red-500 text-white py-2 px-4 rounded btn hover:bg-red-600"
            >
              R√∫t
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Inline JavaScript -->
    <script>
      // Danh s√°ch d·ªØ li·ªáu th√†nh vi√™n
      const memberData = {
        "001": {
          name: "HO√ÄNG VƒÇN MINH ",
          avatar: "https://i.imgur.com/6ceGYoC.jpeg",
          wallet_address:
            "GAB3DTZTDHAQQ2IXO4RDPMYQY3CNZABM6ZGK4HWK55QKRQ6W6QCKRSDQ",
          explorer_link:
            "https://blockexplorer.minepi.com/mainnet/accounts/GAB3DTZTDHAQQ2IXO4RDPMYQY3CNZABM6ZGK4HWK55QKRQ6W6QCKRSDQ",
        },
        "002": {
          name: "L√ä VƒÇN HO·∫∞NG",
          avatar: "https://i.imgur.com/bacHB3U.jpeg",
          wallet_address:
            "GCVBQP2M5AWPLHFLUWX7ZRSE24INWWYEYC2EI3NPQWXIL5WVXXZITGJP",
          explorer_link:
            "https://blockexplorer.minepi.com/mainnet/accounts/GCVBQP2M5AWPLHFLUWX7ZRSE24INWWYEYC2EI3NPQWXIL5WVXXZITGJP",
        },
        "003": {
          name: "PH·∫†M TH·ªä XU√ÇN",
          avatar: "https://i.imgur.com/FgV7fRT.jpeg",
          wallet_address:
            "GBDUXC2JUGEVI7N2NGLXB6B3VMUUVNUK6QI4TL5XIB2LIY3U7CDGK3B4",
          explorer_link:
            "https://blockexplorer.minepi.com/mainnet/accounts/GBDUXC2JUGEVI7N2NGLXB6B3VMUUVNUK6QI4TL5XIB2LIY3U7CDGK3B4",
        },
        "004": {
          name: "L√ä TH·ªä H∆Ø∆†NG",
          avatar: "https://i.imgur.com/qPmerTD.jpeg",
          wallet_address:
            "GCWRIG2I5BNCTN5HXSMAYPQC45MRY7BQFX6AUUPAKTGACFZLBDGJG7I3",
          explorer_link:
            "https://blockexplorer.minepi.com/mainnet/accounts/GCWRIG2I5BNCTN5HXSMAYPQC45MRY7BQFX6AUUPAKTGACFZLBDGJG7I3",
        },
        "005": {
          name: "L√ä TR·ªåNG KHOA",
          avatar: "https://i.imgur.com/h2G4JTA.jpeg",
          wallet_address:
            "GDMBS366RAH5STHNFCH3QWLV4VNK2U77TGFU7WEG66ZFGMHGOWZCHDOZ",
          explorer_link:
            "https://blockexplorer.minepi.com/mainnet/accounts/GDMBS366RAH5STHNFCH3QWLV4VNK2U77TGFU7WEG66ZFGMHGOWZCHDOZ",
        },
        "006": {
          name: "HO√ÄNG VƒÇN TR·ª§",
          avatar: "https://i.imgur.com/wNUTVEz.jpeg",
          wallet_address:
            "GC4QQVU6A4EWTNCW4235WUOQ5FHKBOF57RKO2EPTIXDJKRYTLXZOHSGN",
          explorer_link:
            "https://blockexplorer.minepi.com/mainnet/accounts/GC4QQVU6A4EWTNCW4235WUOQ5FHKBOF57RKO2EPTIXDJKRYTLXZOHSGN",
        },
        "007": {
          name: "MINH TRANG",
          avatar: "https://i.imgur.com/HskgNhC.jpeg",
          wallet_address:
            "GD7M2UZCORSH4AJUJJN2V56MAA33OCIMYMRJ6OXMBQPG5T2FJ4OZ6TA6",
          explorer_link:
            "https://blockexplorer.minepi.com/mainnet/accounts/GD7M2UZCORSH4AJUJJN2V56MAA33OCIMYMRJ6OXMBQPG5T2FJ4OZ6TA6",
        },
        "008": {
          name: "L√ä TH·ªä H√Ä",
          avatar: "https://i.imgur.com/zAX7aF4.jpeg",
          wallet_address:
            "GAL4V2DVKA437NPZT2B6NEQA7AJ4BE53OCKQUXNJ44G3Z3IJF3BGZ7SS",
          explorer_link:
            "https://blockexplorer.minepi.com/mainnet/accounts/GAL4V2DVKA437NPZT2B6NEQA7AJ4BE53OCKQUXNJ44G3Z3IJF3BGZ7SS",
        },
      };

      // Show Toast Notification
      function showToast(message, type = "success") {
        const toast = document.getElementById("toast");
        const toastMessage = document.getElementById("toastMessage");
        toastMessage.textContent = message;
        toast.classList.remove("bg-green-500", "bg-red-500");
        toast.classList.add(type === "success" ? "bg-green-500" : "bg-red-500");
        toast.classList.remove("hidden");
        toast.classList.add("show");
        setTimeout(() => {
          toast.classList.remove("show");
          toast.classList.add("hidden");
        }, 3000);
      }

      // Load user data based on tag_id
      let currentUserTagId = null;
      function loadUserData() {
        const urlParams = new URLSearchParams(window.location.search);
        const tagId = urlParams.get("tag_id");
        currentUserTagId = tagId;
        const userName = document.getElementById("userName");
        const walletAddress = document.getElementById("walletAddress");
        const avatar = document.getElementById("avatar");
        const referralCode = document.getElementById("referralCode");

        if (tagId && memberData[tagId]) {
          const member = memberData[tagId];
          userName.textContent = member.name;
          walletAddress.textContent = member.wallet_address;
          avatar.src = member.avatar;
          referralCode.textContent = tagId; // M√£ gi·ªõi thi·ªáu ch√≠nh l√† tag_id
        } else {
          userName.textContent = "Kh√¥ng t√¨m th·∫•y th√¥ng tin";
          walletAddress.textContent = "Kh√¥ng t√¨m th·∫•y ƒë·ªãa ch·ªâ v√≠";
          avatar.src = "https://picsum.photos/80"; // URL d·ª± ph√≤ng ch√≠nh
          referralCode.textContent = "Kh√¥ng c√≥";
          showToast("Tag ID kh√¥ng h·ª£p l·ªá!", "error");
        }

        // X·ª≠ l√Ω khi h√¨nh ·∫£nh t·∫£i th√†nh c√¥ng ho·∫∑c th·∫•t b·∫°i
        avatar.onload = () => {
          avatar.classList.add("loaded");
        };
        avatar.onerror = () => {
          console.warn(`Kh√¥ng th·ªÉ t·∫£i h√¨nh ·∫£nh: ${avatar.src}`);
          if (avatar.src !== "https://picsum.photos/seed/fallback/80") {
            avatar.src = "https://picsum.photos/seed/fallback/80";
          } else {
            showToast("Kh√¥ng th·ªÉ t·∫£i h√¨nh ·∫£nh ƒë·∫°i di·ªán!", "error");
            avatar.classList.add("loaded");
          }
        };
      }

      // Auto-check balance from URL
      function autoCheckBalanceFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        const walletAddress = urlParams.get("wallet");
        if (walletAddress) {
          document.getElementById("walletAddress").textContent = walletAddress;
          checkBalance();
        }
      }

      // Check Balance (Redirect to Pi Block Explorer)
      function checkBalance() {
        const walletAddress =
          document.getElementById("walletAddress").textContent;

        if (!walletAddress || walletAddress === "Kh√¥ng t√¨m th·∫•y ƒë·ªãa ch·ªâ v√≠") {
          showToast("Kh√¥ng c√≥ ƒë·ªãa ch·ªâ v√≠ ƒë·ªÉ ki·ªÉm tra!", "error");
          return;
        }

        const explorerUrl = `https://blockexplorer.minepi.com/mainnet/accounts/${walletAddress}`;
        window.location.href = explorerUrl;
      }

      // Copy Wallet Address
      function copyWalletAddress() {
        const walletAddress =
          document.getElementById("walletAddress").textContent;
        if (walletAddress === "Kh√¥ng t√¨m th·∫•y ƒë·ªãa ch·ªâ v√≠") {
          showToast("Kh√¥ng c√≥ ƒë·ªãa ch·ªâ v√≠ ƒë·ªÉ sao ch√©p!", "error");
          return;
        }
        navigator.clipboard
          .writeText(walletAddress)
          .then(() => {
            showToast("ƒê√£ sao ch√©p ƒë·ªãa ch·ªâ v√≠!");
          })
          .catch(() => {
            showToast("Kh√¥ng th·ªÉ sao ch√©p ƒë·ªãa ch·ªâ v√≠!", "error");
          });
      }

      // Copy Referral Link
      function copyReferralLink() {
        const tagId = currentUserTagId;
        if (!tagId || !memberData[tagId]) {
          showToast("Kh√¥ng c√≥ m√£ gi·ªõi thi·ªáu ƒë·ªÉ chia s·∫ª!", "error");
          return;
        }
        const referralLink = `${window.location.origin}${window.location.pathname}?tag_id=${tagId}&referrer=${tagId}`;
        navigator.clipboard
          .writeText(referralLink)
          .then(() => {
            showToast("ƒê√£ sao ch√©p li√™n k·∫øt gi·ªõi thi·ªáu!");
          })
          .catch(() => {
            showToast("Kh√¥ng th·ªÉ sao ch√©p li√™n k·∫øt!", "error");
          });
      }

      // Show Referral Modal
      function showReferralModal() {
        const referralModal = document.getElementById("referralModal");
        referralModal.classList.remove("hidden");
        referralModal.classList.add("show");
      }

      // Hide Referral Modal
      function hideReferralModal() {
        const referralModal = document.getElementById("referralModal");
        referralModal.classList.remove("show");
        referralModal.classList.add("hidden");
      }

      // Submit Referral Code
      function submitReferral() {
        const referralCode = document
          .getElementById("referralCodeInput")
          .value.trim();
        if (!referralCode) {
          showToast("Vui l√≤ng nh·∫≠p m√£ gi·ªõi thi·ªáu!", "error");
          return;
        }
        if (!memberData[referralCode]) {
          showToast("M√£ gi·ªõi thi·ªáu kh√¥ng h·ª£p l·ªá!", "error");
          return;
        }
        if (referralCode === currentUserTagId) {
          showToast("B·∫°n kh√¥ng th·ªÉ t·ª± gi·ªõi thi·ªáu ch√≠nh m√¨nh!", "error");
          return;
        }

        checkInData.referrer = referralCode;
        saveCheckInData();
        hideReferralModal();
        showToast("ƒê√£ l∆∞u m√£ gi·ªõi thi·ªáu th√†nh c√¥ng!");
      }

      // Skip Referral
      function skipReferral() {
        checkInData.referrer = null;
        saveCheckInData();
        hideReferralModal();
        showToast("ƒê√£ b·ªè qua b∆∞·ªõc nh·∫≠p m√£ gi·ªõi thi·ªáu!");
      }

      // Show Withdraw Modal
      function showWithdrawModal() {
        const withdrawModal = document.getElementById("withdrawModal");
        withdrawModal.classList.remove("hidden");
        withdrawModal.classList.add("show");
      }

      // Hide Withdraw Modal
      function hideWithdrawModal() {
        const withdrawModal = document.getElementById("withdrawModal");
        withdrawModal.classList.remove("show");
        withdrawModal.classList.add("hidden");
      }

      // Withdraw Pi (Mock)
      function withdrawPi() {
        const amount = parseFloat(
          document.getElementById("withdrawAmount").value
        );
        const password = document.getElementById("withdrawPassword").value;
        const withdrawStatus = document.getElementById("withdrawStatus");

        if (!amount || amount < 0.01) {
          showToast("S·ªë l∆∞·ª£ng Pi ph·∫£i l·ªõn h∆°n 0 v√† t·ªëi thi·ªÉu 1$!", "error");
          return;
        }

        if (!password) {
          showToast("Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u!", "error");
          return;
        }

        withdrawStatus.textContent = "ƒêang x·ª≠ l√Ω...";

        setTimeout(() => {
          withdrawStatus.textContent = "ƒê√£ g·ª≠i y√™u c·∫ßu r√∫t Pi";
          showToast("Y√™u c·∫ßu r√∫t Pi ƒë√£ ƒë∆∞·ª£c g·ª≠i!");
          hideWithdrawModal();
        }, 1500);
      }

      // Safety Check (Mock)
      function checkSafety() {
        const checkButton = document.getElementById("checkButton");
        const loadingSpinner = document.getElementById("loadingSpinner");
        const safetyResult = document.getElementById("safetyResult");
        const safetyStatus = document.getElementById("safetyStatus");
        const safetyScore = document.getElementById("safetyScore");
        const safetyWarnings = document.getElementById("safetyWarnings");

        checkButton.disabled = true;
        loadingSpinner.style.display = "block";
        safetyResult.classList.add("hidden");

        setTimeout(() => {
          loadingSpinner.style.display = "none";
          safetyResult.classList.remove("hidden");

          const isSafe = Math.random() > 0.5;
          safetyResult.classList.remove("safe", "unsafe");
          safetyResult.classList.add(isSafe ? "safe" : "unsafe");
          safetyStatus.textContent = isSafe ? "An to√†n" : "Kh√¥ng an to√†n";
          safetyScore.textContent = isSafe ? "85" : "30";
          safetyWarnings.textContent = isSafe
            ? "Kh√¥ng c√≥ c·∫£nh b√°o"
            : "Trang web c√≥ th·ªÉ kh√¥ng ƒë√°ng tin c·∫≠y";

          checkButton.disabled = false;
          showToast(
            isSafe
              ? "Ki·ªÉm tra th√†nh c√¥ng: An to√†n!"
              : "Ki·ªÉm tra th√†nh c√¥ng: Kh√¥ng an to√†n!",
            isSafe ? "success" : "error"
          );
        }, 1500);
      }

      // Clear Safety Check Form
      function clearForm() {
        document.getElementById("safetyUrl").value = "";
        document.getElementById("safetyResult").classList.add("hidden");
        showToast("ƒê√£ x√≥a bi·ªÉu m·∫´u!");
      }

      // Adventure Check-In Logic
      const levels = [
        {
          name: "Nh√† Du H√†nh M·ªõi üåü",
          minCheckIns: 0,
          pidoge: 5,
          tt: 2,
          next: 3,
          description: "Kh√°m ph√° v≈© tr·ª• m·ªõi v·ªõi tinh th·∫ßn t√≤ m√≤!",
        },
        {
          name: "Th√°m Hi·ªÉm Sao H·ªèa üî¥",
          minCheckIns: 3,
          pidoge: 10,
          tt: 5,
          next: 6,
          description: "Sao H·ªèa - ƒê·∫•t ƒë·ªè b√≠ ·∫©n ch·ªù b·∫°n chinh ph·ª•c!",
        },
        {
          name: "L·ªØ Kh√°ch M·ªôc Tinh ü™ê",
          minCheckIns: 6,
          pidoge: 15,
          tt: 8,
          next: 10,
          description: "M·ªôc Tinh - V√πng ƒë·∫•t c·ªßa nh·ªØng c∆°n b√£o kh·ªïng l·ªì!",
        },
        {
          name: "Ng∆∞·ªùi B·∫£o V·ªá Th·ªï Tinh üí´",
          minCheckIns: 10,
          pidoge: 20,
          tt: 12,
          next: 15,
          description: "Th·ªï Tinh - V√≤ng ƒëai √°nh s√°ng r·ª±c r·ª°!",
        },
        {
          name: "Chi·∫øn Binh Thi√™n V∆∞∆°ng üåå",
          minCheckIns: 15,
          pidoge: 25,
          tt: 15,
          next: 21,
          description: "Thi√™n V∆∞∆°ng - H√†nh tinh l·∫°nh gi√° ƒë·∫ßy b√≠ ·∫©n!",
        },
        {
          name: "Huy·ªÅn Tho·∫°i H·∫£i V∆∞∆°ng üåä",
          minCheckIns: 21,
          pidoge: 30,
          tt: 20,
          next: 28,
          description: "H·∫£i V∆∞∆°ng - Bi·ªÉn xanh th·∫≥m trong v≈© tr·ª•!",
        },
        {
          name: "K·∫ª Chinh Ph·ª•c D·∫£i Ng√¢n H√† ‚ú®",
          minCheckIns: 28,
          pidoge: 40,
          tt: 25,
          next: 36,
          description: "D·∫£i Ng√¢n H√† - V√πng tr·ªùi sao v√¥ t·∫≠n!",
        },
        {
          name: "Ch√∫a T·ªÉ V≈© Tr·ª• üå†",
          minCheckIns: 36,
          pidoge: 50,
          tt: 30,
          next: 45,
          description: "V≈© tr·ª• - Quy·ªÅn nƒÉng t·ªëi th∆∞·ª£ng trong tay b·∫°n!",
        },
        {
          name: "Huy·ªÅn Tho·∫°i V√¥ T·∫≠n ü™ê‚ú®",
          minCheckIns: 45,
          pidoge: 60,
          tt: 40,
          next: Infinity,
          description: "V√¥ T·∫≠n - Ch·ªß nh√¢n c·ªßa m·ªçi h√†nh tinh!",
        },
      ];

      let checkInData = {
        count: 0,
        lastCheckIn: null,
        pidoge: 0,
        tt: 0,
        referrer: null,
        referralRewards: { pidoge: 0, tt: 0 },
      };

      function loadCheckInData() {
        const savedData = localStorage.getItem(
          `checkInData_${currentUserTagId}`
        );
        if (savedData) {
          checkInData = JSON.parse(savedData);
        } else {
          const urlParams = new URLSearchParams(window.location.search);
          const referrer = urlParams.get("referrer");
          if (
            referrer &&
            memberData[referrer] &&
            referrer !== currentUserTagId
          ) {
            checkInData.referrer = referrer;
            saveCheckInData();
          }
        }
        updateAdventureUI();
        updateCheckInButton();
        updateReferralRewardsUI();

        // Ki·ªÉm tra n·∫øu ch∆∞a c√≥ referrer v√† kh√¥ng c√≥ trong URL th√¨ hi·ªán modal
        if (!checkInData.referrer && !urlParams.get("referrer")) {
          showReferralModal();
        }
      }

      function saveCheckInData() {
        localStorage.setItem(
          `checkInData_${currentUserTagId}`,
          JSON.stringify(checkInData)
        );
      }

      function getCurrentLevel(checkIns) {
        return (
          levels.find(
            (level) => checkIns >= level.minCheckIns && checkIns < level.next
          ) || levels[levels.length - 1]
        );
      }

      function updateAdventureUI() {
        const currentLevel = getCurrentLevel(checkInData.count);
        const nextLevel =
          levels.find((level) => level.minCheckIns === currentLevel.next) ||
          currentLevel;
        const progress =
          currentLevel.next === Infinity
            ? 100
            : ((checkInData.count - currentLevel.minCheckIns) /
                (currentLevel.next - currentLevel.minCheckIns)) *
              100;

        document.getElementById("currentLevel").textContent = currentLevel.name;
        document.getElementById("levelDescription").textContent =
          currentLevel.description;
        document.getElementById("checkInCount").textContent = checkInData.count;
        document.getElementById("progressText").textContent = `${
          checkInData.count
        }/${
          currentLevel.next === Infinity ? checkInData.count : currentLevel.next
        }`;
        document.getElementById(
          "levelProgressBar"
        ).style.width = `${progress}%`;
        document.getElementById("pidogeBalance").textContent =
          checkInData.pidoge;
        document.getElementById("ttBalance").textContent = checkInData.tt;
      }

      function updateReferralRewardsUI() {
        document.getElementById(
          "referralRewards"
        ).textContent = `${checkInData.referralRewards.pidoge} Pidoge | ${checkInData.referralRewards.tt} TT`;
      }

      function updateCheckInButton() {
        const checkInButton = document.getElementById("checkInButton");
        const checkInStatus = document.getElementById("checkInStatus");
        const now = Date.now();
        const timeSinceLast = checkInData.lastCheckIn
          ? now - checkInData.lastCheckIn
          : Infinity;
        const oneDay = 24 * 60 * 60 * 1000;

        if (timeSinceLast < oneDay) {
          checkInButton.disabled = true;
          const remainingTime = oneDay - timeSinceLast;
          const hours = Math.floor(remainingTime / (1000 * 60 * 60));
          const minutes = Math.floor(
            (remainingTime % (1000 * 60 * 60)) / (1000 * 60)
          );
          const seconds = Math.floor((remainingTime % (1000 * 60)) / 1000);
          checkInStatus.textContent = `Ch·ªù ${hours}h ${minutes}m ${seconds}s ƒë·ªÉ kh√°m ph√° ti·∫øp`;
          setTimeout(updateCheckInButton, 1000);
        } else {
          checkInButton.disabled = false;
          checkInStatus.textContent = "S·∫µn s√†ng kh√°m ph√° h√†nh tinh m·ªõi!";
        }
      }

      function checkIn() {
        const now = Date.now();
        const timeSinceLast = checkInData.lastCheckIn
          ? now - checkInData.lastCheckIn
          : Infinity;
        const oneDay = 24 * 60 * 60 * 1000;

        if (timeSinceLast < oneDay) {
          showToast("B·∫°n ƒë√£ kh√°m ph√° h√¥m nay, h√£y quay l·∫°i sau!", "error");
          return;
        }

        checkInData.count++;
        checkInData.lastCheckIn = now;
        const currentLevel = getCurrentLevel(checkInData.count);
        checkInData.pidoge += currentLevel.pidoge;
        checkInData.tt += currentLevel.tt;

        // T√≠nh ph·∫ßn th∆∞·ªüng gi·ªõi thi·ªáu (15%)
        if (checkInData.referrer) {
          const referrerData = JSON.parse(
            localStorage.getItem(`checkInData_${checkInData.referrer}`)
          ) || {
            count: 0,
            lastCheckIn: null,
            pidoge: 0,
            tt: 0,
            referrer: null,
            referralRewards: { pidoge: 0, tt: 0 },
          };
          const referralBonusPidoge = currentLevel.pidoge * 0.15;
          const referralBonusTT = currentLevel.tt * 0.15;
          referrerData.referralRewards.pidoge += referralBonusPidoge;
          referrerData.referralRewards.tt += referralBonusTT;
          localStorage.setItem(
            `checkInData_${checkInData.referrer}`,
            JSON.stringify(referrerData)
          );
          showToast(
            `Ng∆∞·ªùi gi·ªõi thi·ªáu c·ªßa b·∫°n nh·∫≠n ${referralBonusPidoge} Pidoge v√† ${referralBonusTT} TT!`
          );
        }

        saveCheckInData();
        updateAdventureUI();
        updateCheckInButton();
        updateReferralRewardsUI();

        showToast(
          `Kh√°m ph√° th√†nh c√¥ng! Nh·∫≠n ${currentLevel.pidoge} Pidoge v√† ${currentLevel.tt} TT!`,
          "success"
        );
      }

      // Initialize on page load
      document.addEventListener("DOMContentLoaded", () => {
        loadUserData();
        autoCheckBalanceFromURL();
        loadCheckInData();

        // Lazy load TradingView Widget
        const tradingViewSection = document.getElementById("tradingview_chart");
        const observer = new IntersectionObserver(
          (entries) => {
            if (entries[0].isIntersecting) {
              new TradingView.widget({
                width: "100%",
                height: 250,
                symbol: "OKX:PIUSDT",
                interval: "D",
                timezone: "Etc/UTC",
                theme: "dark",
                style: "1",
                locale: "en",
                toolbar_bg: "#1a1a3d",
                enable_publishing: false,
                allow_symbol_change: true,
                container_id: "tradingview_chart",
              });
              observer.disconnect();
            }
          },
          { rootMargin: "100px" }
        );
        observer.observe(tradingViewSection);
      });
    </script>
  </body>
</html>
